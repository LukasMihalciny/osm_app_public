"use strict";(self["webpackChunkosmapp_webpack_3xx"]=self["webpackChunkosmapp_webpack_3xx"]||[]).push([[428],{6884:function(e,a,t){var i=t(8700),n=t(6343),o=t(3175);class r{identity_scan(e,a,t){let r={action_name:"identity-scan",method:"GET",url:(0,i.A)().endpoint_url()+"online/identity-scan/?"+n.A.add_token_as_parameter()};r.url+="&serviceToken=veriface&scanGroupName="+a+"&identType="+t+"&identNew="+(e?"true":"false");let s=new o.A;return s.prepare_params(r).handle_response().catch((e=>{throw e}))}identity_check(e){let a={action_name:"identity-scan-check",method:"GET",url:(0,i.A)().endpoint_url()+"online/identity-scan-check/?"+n.A.add_token_as_parameter()};a.url+="&serviceToken=veriface&scanGroupName="+e;let t=new o.A;return t.prepare_params(a).handle_response().catch((e=>{throw e}))}identity_refresh(){let e={action_name:"id-scan/get-scan-groups",method:"GET",url:(0,i.A)().endpoint_url()+"api/online/id-scan/get-scan-groups/?"+n.A.add_token_as_parameter()},a=new o.A;return a.prepare_params(e).handle_response().catch((e=>{throw e}))}identity_flow_scan(e,a,t,n){let r={action_name:"identity-scan",method:"GET",url:(0,i.A)().endpoint_url()+"osmapi/identity-scan/"+(0,i.A)().get_session_token()+"/?"};r.url+="serviceToken=veriface&identToken="+a+"&identType="+t+"&action-id="+n+"&identNew="+(e?"true":"false");let s=new o.A;return s.prepare_params(r).handle_response().catch((e=>{throw e}))}identity_flow_check(e,a){let t={action_name:"identity-scan-check",method:"GET",url:(0,i.A)().endpoint_url()+"osmapi/identity-scan-check/"+(0,i.A)().get_session_token()+"/?"};t.url+="serviceToken=veriface&identToken="+e+"&action-id="+a;let n=new o.A;return n.prepare_params(t).handle_response().catch((e=>{throw e}))}identity_flow_refresh(){let e={action_name:"identity-scan-check",method:"GET",url:(0,i.A)().endpoint_url()+"osmapi/identity-scan-check/"+(0,i.A)().get_session_token()+"/?"};e.url+="serviceToken=veriface";let a=new o.A;return a.prepare_params(e).handle_response().catch((e=>{throw e}))}}a.A=new r},8428:function(e,a,t){t.r(a),t.d(a,{default:function(){return K}});var i=t(641),n=t(33);const o={class:"row facial_scan"},r={key:0,class:"col-12 mb-5 mt-2"},s={class:"lead"},c={key:1,class:"col-12 col-sm-6 mb-5"},l={class:"fw-bold"},d={key:1},_={class:"fw-bold"},p={key:1},k={class:"fw-bold"},f={key:0},v={key:1},h={class:"fw-bold"},u=["href"],m={key:1},b={key:2,class:"col-12 col-sm-6 mb-5 d-none d-sm-block"},y=["src"],g={key:1,class:"qr_code placeholder"},w={class:"fw-bold"},E={key:1},A={key:3,class:"col-12"},L={class:"text-center"},C=["disabled"],S={key:4,class:"col-12"},T={class:"col-12 text-center my-3"},x={class:"col-12 mb-3"};function N(e,a,t,N,X,z){const D=(0,i.g2)("Veriface_iframe"),O=(0,i.g2)("Bouncer_loading"),P=(0,i.g2)("Scan_feedback"),U=(0,i.g2)("Modal_body");return(0,i.uX)(),(0,i.Wv)(U,{close:X.allow_closing,title:"op"===z.scan_type?"Naskenovanie dokladov":"Tvárová biometria",class:(0,n.C4)("op"===z.scan_type?"modal-credentials_scan":"modal-faceauth"),modal_size:"medium"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",o,[X.load_iframe?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",r,[(0,i.Lk)("p",s,[(0,i.eW)((0,n.v_)("op"===z.scan_type?"Pre bezpečné overenie Vašej osoby nahrajte prosím doklad totožnosti.":"Pre bezpečné overenie Vašej osoby potrebujeme porovnať doklad totožnosti s tvárovou biometriou.")+" ",1),a[5]||(a[5]=(0,i.Lk)("br",null,null,-1)),a[6]||(a[6]=(0,i.eW)("Vyberte si jednu z možností, podľa preferovaného zariadenia: "))])])),X.load_iframe?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",c,[a[7]||(a[7]=(0,i.Lk)("p",null,[(0,i.Lk)("b",{class:"text-primary"},"A) "),(0,i.eW)("Pre spustenie overovania na "),(0,i.Lk)("b",null,"tomto zariadení"),(0,i.eW)(" kliknite na link.")],-1)),(0,i.Lk)("p",l,[X.veriface_link?((0,i.uX)(),(0,i.CE)("a",{key:0,onClick:a[0]||(a[0]=(...e)=>z.switch_to_iframe&&z.switch_to_iframe(...e)),href:"#"}," VeriFace iframe (odporúčané) ")):((0,i.uX)(),(0,i.CE)("span",d,"Načítavam..."))]),a[8]||(a[8]=(0,i.Lk)("p",{class:"mt-4"},[(0,i.Lk)("b",{class:"text-primary"},"B) "),(0,i.eW)("Pre spustenie overovania na "),(0,i.Lk)("b",null,"tomto zariadení"),(0,i.eW)(" kliknite na link.")],-1)),(0,i.Lk)("p",_,[X.veriface_link?((0,i.uX)(),(0,i.CE)("a",{key:0,onClick:a[1]||(a[1]=(...e)=>z.open_veriface_next_tab&&z.open_veriface_next_tab(...e)),href:"#"}," Otvoriť v novom okne ")):((0,i.uX)(),(0,i.CE)("span",p,"Načítavam..."))]),a[9]||(a[9]=(0,i.Lk)("p",{class:"mt-4"},[(0,i.Lk)("b",{class:"text-primary"},"C) "),(0,i.eW)("Pre preposlanie "),(0,i.Lk)("b",null,"ľubovolným spôsobom"),(0,i.eW)(", skopírujte link.")],-1)),(0,i.Lk)("p",k,[X.veriface_link?((0,i.uX)(),(0,i.CE)("span",f,[(0,i.eW)((0,n.v_)(X.veriface_link)+" ",1),(0,i.Lk)("a",{onClick:a[2]||(a[2]=(...e)=>z.to_clipboard&&z.to_clipboard(...e)),href:"#",class:"position-absolute"},[(0,i.Lk)("span",{class:(0,n.C4)(["i_clipboard",X.clipboard_helper?"i_clipboard_success":""])},null,2)])])):((0,i.uX)(),(0,i.CE)("span",v,"Načítavam..."))]),a[10]||(a[10]=(0,i.Lk)("p",{class:"mt-4"},[(0,i.Lk)("b",{class:"text-primary"},"D) "),(0,i.eW)("Pre preposlanie emailom na "),(0,i.Lk)("b",null,"iné zariadenie"),(0,i.eW)(", kliknite na link.")],-1)),(0,i.Lk)("p",h,[X.veriface_link?((0,i.uX)(),(0,i.CE)("a",{key:0,href:z.mail_sample}," Skopírovať do emailového klienta. ",8,u)):((0,i.uX)(),(0,i.CE)("span",m,"Načítavam..."))])])),X.load_iframe?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",b,[a[11]||(a[11]=(0,i.Lk)("p",null,[(0,i.Lk)("b",{class:"text-primary"},"E) "),(0,i.eW)("Pre spustenie overovania na "),(0,i.Lk)("b",null,"mobilnom zariadení"),(0,i.eW)(", načítajte QR kód.")],-1)),X.veriface_qr?((0,i.uX)(),(0,i.CE)("img",{key:0,src:"data:image/png;base64,"+X.veriface_qr,class:"qr_code"},null,8,y)):((0,i.uX)(),(0,i.CE)("div",g)),a[12]||(a[12]=(0,i.Lk)("p",{class:"mt-4"},[(0,i.Lk)("b",{class:"text-primary"},"F) "),(0,i.eW)("Pre vyžiadanie "),(0,i.Lk)("b",null,"nového overovania"),(0,i.eW)(" kliknite na link.")],-1)),(0,i.Lk)("p",w,[X.veriface_link?((0,i.uX)(),(0,i.CE)("a",{key:0,onClick:a[3]||(a[3]=(...e)=>z.reset_veriface&&z.reset_veriface(...e)),href:"#"}," Nové overovanie ")):((0,i.uX)(),(0,i.CE)("span",E,"Načítavam..."))])])),X.load_iframe?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",A,[a[13]||(a[13]=(0,i.Lk)("ul",{class:"mb-4 dots-primary"},[(0,i.Lk)("li",{class:"mb-0"},"Okno nezatvárajte."),(0,i.Lk)("li",{class:"mb-0"},"Pripravte si doklad totožnosti."),(0,i.Lk)("li",{class:"mb-0"},"Otvorte aplikáciu overovania na Vami preferovanom zariadení."),(0,i.Lk)("li",{class:"mb-0"},"Postupujte podľa pokynov v aplikácii overovania."),(0,i.Lk)("li",{class:"mb-0"},'Keď proces úspešne dokončíte kliknite na tlačidlo "Skontrolovať stav".')],-1)),(0,i.Lk)("div",L,[(0,i.Lk)("button",{onClick:a[4]||(a[4]=(...e)=>z.face_check&&z.face_check(...e)),disabled:X.loading,class:"btn btn-primary"}," Skontrolovať stav ",8,C)])])),X.load_iframe?((0,i.uX)(),(0,i.CE)("div",S,[(0,i.bF)(D,{veriface_link:X.veriface_link,onVeriface_closing:z.veriface_closing},null,8,["veriface_link","onVeriface_closing"])])):(0,i.Q3)("",!0),(0,i.Lk)("div",T,[X.loading?((0,i.uX)(),(0,i.Wv)(O,{key:0})):(0,i.Q3)("",!0)]),(0,i.Lk)("div",x,[(0,i.bF)(P,{feedback:X.feedback},null,8,["feedback"])])])])),_:1},8,["close","title","class"])}t(4114);var X=t(4883),z=t(2873),D=t(55),O=t(6884),P=t(6460),U=t(3177),j=t(9614),W=t(7406),V=t(8700),G=t(5143);const I=["src"];function q(e,a,t,o,r,s){return(0,i.uX)(),(0,i.CE)("iframe",{src:t.veriface_link+"&embedded=true",allow:"camera;microphone",scrolling:"no",style:(0,n.Tr)([{width:"100%",transition:"all .5s","min-height":"300px",overflow:"none"},{height:r.height+"px"}])},null,12,I)}var F={props:{veriface_link:String},components:{},emits:["veriface_closing"],data(){return{height:300}},created(){window.addEventListener("message",this.listen_to_veriface)},beforeUnmount(){window.removeEventListener("message",this.listen_to_veriface)},methods:{listen_to_veriface(e){"https://app.veriface.eu"===e.origin&&("height"===e.data.action?this.height=Math.round(e.data.value):"close"===e.data.action&&this.$emit("veriface_closing",e.data.result))}},computed:{},watch:{}},Q=t(6262);const R=(0,Q.A)(F,[["render",q]]);var M=R,B={props:{},components:{Modal_body:X.A,Bouncer_loading:D.A,Scan_feedback:W.A,Veriface_iframe:M},emits:[],data(){return{debug:!1,loading:!0,allow_closing:!0,veriface_link:"",veriface_qr:"",feedback:[],load_iframe:!1,clipboard_helper:!1,check_attempt:0,check_max:10,check_delay:1e4}},created(){this.debug&&(this.add_feedback("DEBUG ON."),this.add_feedback("scanGroupName: "+this.facial_input_token)),this.face_init(!1)},methods:{face_init(e){this.veriface_link="",this.veriface_qr="",this.loading=!0,Promise.resolve().then((()=>this.common_api?O.A.identity_scan(e,this.facial_input_token,this.scan_type):O.A.identity_flow_scan(e,this.facial_input_token,this.scan_type,this.flow_action_id))).then((e=>{let a=!1;if(this.loading=!1,200!==e.status)return this.add_feedback("Aktivácia overovania zlyhala."),void this.add_feedback(JSON.stringify(e.result?.message));this.common_api?(this.veriface_link=e.result?.data?.url,this.veriface_qr=e.result?.data?.base64png,a=e.result?.data?.newScanId||!1):(this.veriface_link=e.result?.data?.resultData?.data?.url,this.veriface_qr=e.result?.data?.resultData?.data?.base64png,a=e.result?.data?.resultData?.data?.newScanId||!1),a||this.face_check()}))},face_check(){if(0===this.check_attempt&&this.add_feedback("Kontrolujeme stav overovania."),this.load_iframe=!1,this.loading=!0,this.check_attempt++,this.check_attempt>this.check_max)return this.add_feedback("Dosiahnuté maximálne množstvo pokusov. Vyskúšajte znovu alebo kontaktujte technickú podporu."),this.loading=!1,void(this.check_attempt=0);Promise.resolve().then((()=>this.common_api?O.A.identity_check(this.facial_input_token):O.A.identity_flow_check(this.facial_input_token,this.flow_action_id))).then((e=>{if(200!==e.status)return this.add_feedback("Kontrola overovania zlyhala."),void this.add_feedback(JSON.stringify(e.result?.message));this.common_api?this.face_fill(e.result):this.face_fill(e.result?.data?.resultData)}))},face_fill(e){if(console.log(e?.["scan-status"],e?.["provider-info"]?.status,e?.["provider-info"]?.verificationEndUserStatus),"UNSTARTED"===e?.["provider-info"]?.verificationEndUserStatus)return this.add_feedback("Proces overovania nebol započatý."),this.loading=!1,void(this.check_attempt=0);if("NOT_FINISHED"===e?.["provider-info"]?.verificationEndUserStatus)return this.add_feedback("Overovanie ešte prebieha."),this.loading=!1,void(this.check_attempt=0);if("SUCCESS"===e?.["provider-info"]?.verificationEndUserStatus)this.add_feedback("Overovanie úspešné. Kontrolujeme dokumenty.");else{if("FAILURE"===e?.["provider-info"]?.verificationEndUserStatus)return this.add_feedback("Overovanie nebolo úspešné. Možte vyžiadať nové overovanie."),this.loading=!1,void(this.check_attempt=0);if("CANCELLED"===e?.["provider-info"]?.verificationEndUserStatus)return this.add_feedback("Overovanie bolo zrušené užívatelom. Možte vyžiadať nové overovanie."),this.loading=!1,void(this.check_attempt=0);if("EXPIRED"===e?.["provider-info"]?.verificationEndUserStatus)return this.add_feedback("Overovací proces nebol dokončený včas. Možte vyžiadať nové overovanie."),this.loading=!1,void(this.check_attempt=0);if("POSTPONED"===e?.["provider-info"]?.verificationEndUserStatus)return this.add_feedback("Overovanie bolo dočasne pozdržané."),this.loading=!1,void(this.check_attempt=0)}if("verified"!==e?.["scan-status"])return void setTimeout((()=>{this.veriface_closing("internal_repeat")}),this.check_delay);if(this.loading=!1,"object"!==typeof e?.data||Object.keys(e?.data).length<=0)return this.add_feedback("Dáta v nesprávnom formáte."),void this.add_feedback(JSON.stringify(e));this.add_feedback("Dokumenty sú v poriadku. Ukladáme Vaše údaje."),(0,U.A)().set_form_value(this.facial_input_token,"1"),(0,P.A)().clear_one_error(this.facial_input_token);let a=this.facial_settings?.prefix||"",t=this.facial_settings?.suffix||"";(0,U.A)().set_multiple_form_values(e?.data,a,t),this.debug&&(this.add_feedback(JSON.stringify(e?.data)),this.add_feedback('PREFIX: "'+a+'"'),this.add_feedback('SUFFIX: "'+t+'"')),setTimeout((()=>{(0,z.A)().close_them_all(),(0,j.A)().set_requested_direction("forward")}),3e3)},veriface_closing(e){console.log("veriface",e),"SUCCESS"===e||"internal_repeat"===e?this.face_check():(0,z.A)().close_them_all()},add_feedback(e){this.feedback.push(e)},open_veriface_next_tab(e){e.preventDefault(),window.open(this.veriface_link,"_blank").focus()},switch_to_iframe(e){e.preventDefault(),this.load_iframe=!0,this.allow_closing=!1},to_clipboard(e){e.preventDefault(),navigator.clipboard.writeText(this.veriface_link),this.clipboard_helper=!0,setTimeout((()=>{this.clipboard_helper=!1}),3e3)},reset_veriface(e){e.preventDefault(),this.face_init(!0)}},computed:{facial_input_token(){return(0,z.A)().retrieve_modal_data().field_id},facial_settings(){return(0,z.A)().retrieve_modal_data().data_fill},scan_type(){return(0,z.A)().retrieve_modal_data().scan_type},flow_action_id(){if(this.common_api)return null;let e=(0,G.A)().get_workflow_actions();for(let a in e)if("identityScan"===e[a]?.function&&e[a]?.functionParams?.identToken===this.facial_input_token)return e[a].id;return null},common_api(){return"form_app"===(0,V.A)().get_run_mode()},mail_sample(){let e=encodeURIComponent("op"===this.scan_type?"Naskenovanie dokladov":"Tvárová biometria"),a=encodeURIComponent("Dobrý deň, \n\r zasielame Vám link pre overenie totožnosti: \n\r\n\r "+this.veriface_link+" \n\r\n\r S pozdravom \n\r");return"mailto:?subject="+e+"&body="+a}},watch:{}};const J=(0,Q.A)(B,[["render",N]]);var K=J}}]);