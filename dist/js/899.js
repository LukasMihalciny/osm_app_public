"use strict";(self["webpackChunkosmapp_webpack_3xx"]=self["webpackChunkosmapp_webpack_3xx"]||[]).push([[899],{7618:function(e,a,t){var s=t(1114),n=(t(4114),t(6343)),i=t(9452),c=t(6460),o=t(4144);class r{constructor(){(0,s.A)(this,"field_id","")}check_scan_promise(){return new Promise(((e,a)=>{let t=this.displayed_scan_inputs_in_current_tab();0!==t.length?Promise.resolve().then((()=>o.A.scan_refresh())).then((e=>{if(200===e.status)return i.A.session_info();a("get-scan-groups failed")})).then((s=>{if(200!==s.status)return void a("sessioninfo failed");let i=s.result.scan_id_status,o=!1;if(!0===i.required&&!1===i.succeeded){for(let e=0;e<t.length;e++){if(e+1>i.count)break;let a=t[e];!0!==i.names[a]&&((0,c.A)().set_one_error(a,"Občianský preukaz je povinný."),o=!0)}o?(n.A.adjust_view(!0),a("scan required, reject validate")):e()}else e()})):e()}))}displayed_scan_inputs_in_current_tab(){let e=[],a=n.A.active_tab();for(let t in a){let s=n.A.first_value(a[t]),i=n.A.first_key(a[t]);"scan_modal"===s.type_settings?.upload&&e.push(i)}return e}}a.A=new r},4144:function(e,a,t){var s=t(8700),n=t(6343),i=t(3175);class c{add_page(e,a,t){let c={image:e.split(",")?.[1]||""},o={action_name:"id-scan/add-page",method:"POST",url:(0,s.A)().endpoint_url()+"api/online/id-scan/add-page/?scanPage="+a+"&scanGroupName="+t+n.A.add_token_as_parameter(),body:JSON.stringify(c),content_type:"application/json"},r=new i.A;return r.prepare_params(o).handle_response().catch((e=>{throw e}))}scan_groups(e){let a={action_name:"id-scan/get-scan-groups",method:"GET",url:(0,s.A)().endpoint_url()+"api/online/id-scan/get-scan-groups/?scanGroupName="+e+n.A.add_token_as_parameter()},t=new i.A;return t.prepare_params(a).handle_response().catch((e=>{throw e}))}scan_refresh(){let e={action_name:"id-scan/get-scan-groups",method:"GET",url:(0,s.A)().endpoint_url()+"api/online/id-scan/get-scan-groups/?"+n.A.add_token_as_parameter()},a=new i.A;return a.prepare_params(e).handle_response().catch((e=>{throw e}))}scan_group_documents(e){let a={action_name:"id-scan/get-scan-group-documents",method:"GET",url:(0,s.A)().endpoint_url()+"api/online/id-scan/get-scan-group-documents/?scanGroupName="+e+n.A.add_token_as_parameter()},t=new i.A;return t.prepare_params(a).handle_response().catch((e=>{throw e}))}}a.A=new c},9452:function(e,a,t){var s=t(8700),n=t(6343),i=t(3175);class c{session_info(){let e={action_name:"getsessioninfo",method:"GET",url:(0,s.A)().endpoint_url()+"online/getsessioninfo/?"+n.A.add_token_as_parameter()},a=new i.A;return a.prepare_params(e).handle_response().catch((e=>{throw e}))}get_data(){let e={action_name:"getdata",method:"GET",url:(0,s.A)().endpoint_url()+"online/getdata/?"+n.A.add_token_as_parameter()},a=new i.A;return a.prepare_params(e).handle_response().catch((e=>{throw e}))}set_data(e){let a={action_name:"setdata",method:"POST",url:(0,s.A)().endpoint_url()+"online/setdata/?"+n.A.serialize_object(e)+n.A.add_token_as_parameter()},t=new i.A;return t.prepare_params(a).handle_response().catch((e=>{throw e}))}}a.A=new c},5899:function(e,a,t){t.r(a),t.d(a,{default:function(){return Q}});var s=t(641);const n={class:"drag-n-drop"},i=["onClick"];function c(e,a,t,c,o,r){const d=(0,s.g2)("Scan_capture"),_=(0,s.g2)("Scan_upload"),l=(0,s.g2)("Scan_check"),u=(0,s.g2)("Scan_feedback"),p=(0,s.g2)("Modal_body");return(0,s.uX)(),(0,s.Wv)(p,{close:!0,title:"Naskenovanie dokladov",class:"modal-credentials_scan"},{default:(0,s.k6)((()=>[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(2,(e=>(0,s.Lk)("div",n,[(0,s.Lk)("button",{onClick:a=>r.camera_toggle(e),class:"btn btn-primary dd_camera"},a[0]||(a[0]=[(0,s.Lk)("span",{class:"i_camera"},null,-1)]),8,i),o.active_cameras[e]?((0,s.uX)(),(0,s.Wv)(d,{key:0,position:e,onScan_payload:r.scan_payload,onScan_feedback:r.add_to_feedback},null,8,["position","onScan_payload","onScan_feedback"])):((0,s.uX)(),(0,s.Wv)(_,{key:1,position:e,debug:o.debug,onScan_payload:r.scan_payload,onScan_feedback:r.add_to_feedback},null,8,["position","debug","onScan_payload","onScan_feedback"]))]))),64)),(0,s.bF)(l,{debug:o.debug,side_payloads:o.side_payloads,onScan_feedback:r.add_to_feedback},null,8,["debug","side_payloads","onScan_feedback"]),(0,s.bF)(u,{feedback:o.feedback},null,8,["feedback"])])),_:1})}t(4114);var o=t(8384),r=t(3751);const d={class:"contentarea_video"},_={class:"scan_camera"},l={ref:"video",class:"scan_video"},u={ref:"button",class:"scan_button btn btn-primary"},p={ref:"canvas",class:"scan_canvas"},h={class:"scan_output"},m={ref:"photo",class:"scan_photo",alt:"The screen capture will appear in this box."};function f(e,a,t,n,i,c){return(0,s.uX)(),(0,s.CE)("div",d,[(0,s.bo)((0,s.Lk)("div",_,[(0,s.Lk)("video",l," Video stream not available. ",512),(0,s.Lk)("button",u," Odfotiť ",512)],512),[[r.aG,!i.show_result]]),(0,s.Lk)("canvas",p,null,512),(0,s.bo)((0,s.Lk)("div",h,[(0,s.Lk)("img",m,null,512)],512),[[r.aG,i.show_result]])])}var b={props:{position:Number},components:{},emits:["scan_feedback","scan_payload"],data(){return{show_result:!1}},created(){void 0!==navigator.mediaDevices?this.$nextTick((()=>{this.scan_stream()})):this.$emit("scan_feedback","Zariadenie pravdepodobne nemá kameru.")},methods:{scan_stream(){var e=550,a=0,t=!1,s=this.$refs.video,n=this.$refs.canvas,i=this.$refs.photo,c=this.$refs.button;function o(){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(e){s.srcObject=e,s.play()})).catch((function(e){console.log("An error occurred: "+e)})),s.addEventListener("canplay",(function(i){t||(a=s.videoHeight/(s.videoWidth/e),isNaN(a)&&(a=e/(4/3)),s.setAttribute("width",e),s.setAttribute("height",a),n.setAttribute("width",e),n.setAttribute("height",a),t=!0)}),!1),c.addEventListener("click",(function(e){d(),_(),e.preventDefault()}),!1),r()}function r(){var e=n.getContext("2d");e.fillStyle="#AAA",e.fillRect(0,0,n.width,n.height);var a=n.toDataURL("image/png");i.setAttribute("src",a)}function d(){var t=n.getContext("2d");if(e&&a){n.width=e,n.height=a,t.drawImage(s,0,0,e,a);var c=n.toDataURL("image/png");i.setAttribute("src",c)}else r()}const _=()=>{this.show_result=!0,this.$emit("scan_payload",i.src,this.position)};o()}},computed:{},watch:{}},g=t(6262);const k=(0,g.A)(b,[["render",f]]);var v=k;const y={class:"text-center"},A=["disabled"],w={class:"mt-1"};function $(e,a,t,n,i,c){const o=(0,s.g2)("Bouncer_loading");return(0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>c.send_scan_pages&&c.send_scan_pages(...e)),disabled:c.pages_not_ready,class:"btn btn-primary"}," Overiť a vyplniť údaje ",8,A),(0,s.bo)((0,s.Lk)("div",w,[(0,s.bF)(o,{size:"small"})],512),[[r.aG,i.loading]]),t.debug&&i.manual_close_button?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:a[1]||(a[1]=(...e)=>c.close_the_scan&&c.close_the_scan(...e)),class:"btn btn-secondary ms-1"}," Zatvor debug a spusti validate ")):(0,s.Q3)("",!0)])}t(4979),t(1678);var S=t(55),L=t(4144),C=(t(7618),t(2873)),E=t(3177),j=(t(8700),t(6343)),N=t(6460),G=t(9614),x={props:{debug:Boolean,side_payloads:Object},components:{Bouncer_loading:S.A},emits:["scan_feedback"],data(){return{loading:!1,check_repeated:0,max_checks:7,check_delay:5e3,manual_repeat:!1,manual_close_button:!1}},created(){this.debug&&(this.$emit("scan_feedback","DEBUG ON."),this.$emit("scan_feedback","scanGroupName : "+this.scan_input_token))},methods:{send_scan_pages(){this.pages_not_ready||(this.loading=!0,this.debug&&this.$emit("scan_feedback","sending pages"),this.manual_repeat?this.credentials_check():Promise.resolve().then((()=>L.A.add_page(this.side_payloads["1"],1,this.scan_input_token))).then((e=>{if(200!==e.status)return this.$emit("scan_feedback","Nahrávanie strany 1 zlyhalo."),Promise.reject(e.result);this.debug&&this.$emit("scan_feedback","page 1 sent")})).then((async()=>(await j.A.sleep(2),L.A.add_page(this.side_payloads["2"],2,this.scan_input_token)))).then((e=>{if(200!==e.status)return this.$emit("scan_feedback","Nahrávanie strany 2 zlyhalo."),Promise.reject(e.result);this.debug&&this.$emit("scan_feedback","page 2 sent")})).then((async e=>{this.check_repeated=0,await j.A.sleep(4),this.credentials_check()})).catch((e=>{this.loading=!1,console.log(e)})))},credentials_check(){this.debug&&this.$emit("scan_feedback","asking backend for scan check"),L.A.scan_groups(this.scan_input_token).then((e=>{422===e.status?(this.loading=!1,this.$emit("scan_feedback","422 Unprocessable Entity, message: "),this.$emit("scan_feedback",e.result.message)):500===e.status?(this.loading=!1,this.$emit("scan_feedback","500 Internal Server Error, message: "),this.$emit("scan_feedback",e.result.message)):425!==e.status||this.manual_repeat?425===e.status&&this.manual_repeat?(this.loading=!1,this.$emit("scan_feedback","Nepodarilo sa načítať údaje.")):(this.data=e.result,this.$emit("scan_feedback","Overovanie úspešné."),this.debug&&this.$emit("scan_feedback",JSON.stringify(this.data)),this.fill_data(),this.loading=!1):(0===this.check_repeated&&this.$emit("scan_feedback","Prebieha spracovanie."),this.check_repeated++,setTimeout((()=>{this.check_repeated<this.max_checks?(this.debug&&this.$emit("scan_feedback","repeat check no. "+this.check_repeated),this.credentials_check()):(this.$emit("scan_feedback","Nepodarilo sa načítať údaje. Spracovanie dát z dokladu stále prebieha. Zopakujte akciu kliknutím na tlačidlo."),this.loading=!1,this.manual_repeat=!0)}),this.check_delay))}))},fill_data(){this.debug&&this.$emit("scan_feedback","filling received data into form"),(0,E.A)().set_form_value(this.scan_input_token,"1"),(0,N.A)().clear_one_error(this.scan_input_token);let e=this.scan_settings?.prefix||"",a=this.scan_settings?.suffix||"";(0,E.A)().set_multiple_form_values(this.data,e,a),this.store_docs_into_session(),this.debug?this.manual_close_button=!0:setTimeout((()=>{this.close_the_scan()}),3e3)},close_the_scan(){(0,C.A)().close_them_all(),(0,G.A)().set_requested_direction("forward")},async store_docs_into_session(){await j.A.sleep(6),this.debug&&this.$emit("scan_feedback","start scan documents request"),L.A.scan_group_documents(this.scan_input_token).then((async e=>{if(425===e.status)return await j.A.sleep(8),void L.A.scan_group_documents(this.scan_input_token);this.debug&&(200===e.status?this.$emit("scan_feedback","scan documents successful"):this.$emit("scan_feedback","scan documents failed"))}))}},computed:{pages_not_ready(){return!this.side_payloads["1"]||!this.side_payloads["2"]||this.loading},scan_input_token(){return(0,C.A)().retrieve_modal_data().field_id},scan_settings(){return(0,C.A)().retrieve_modal_data().data_fill},watch_if_payloads_changed(){return structuredClone(this.side_payloads)}},watch:{watch_if_payloads_changed(){this.manual_repeat=!1}}};const P=(0,g.A)(x,[["render",$]]);var D=P,O=t(7406),T=t(33);const X=["src"],z={class:"dd_instructions"},U={class:"dd_filename"},R={class:"i_check"},F={key:2},W=["for"],B=["id","name"];function q(e,a,t,n,i,c){return(0,s.uX)(),(0,s.CE)("div",{onDragenter:a[1]||(a[1]=(0,r.D$)((()=>{}),["prevent"])),onDragover:a[2]||(a[2]=(0,r.D$)((()=>{}),["prevent"])),onDrop:a[3]||(a[3]=(0,r.D$)(((...e)=>c.file_change&&c.file_change(...e)),["prevent"]))},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(2,(e=>(0,s.Lk)("div",{class:(0,T.C4)(1===e?"dd_desktop":"dd_mobile")},[i.success?((0,s.uX)(),(0,s.CE)("img",{key:0,src:i.file.url,class:"scan_base64"},null,8,X)):((0,s.uX)(),(0,s.CE)("div",{key:1,class:(0,T.C4)(1===e?"i_dd_upload":"i_dd_camera")},null,2)),(0,s.Lk)("p",z,[(0,s.eW)((0,T.v_)(1===t.position?"Predná":"Zadná")+" strana - ",1),(0,s.Lk)("span",U,(0,T.v_)(i.success?i.file.name:1===e?"Presuňte súbor sem (JPEG, PNG)":"Pripravte si doklad na odfotenie"),1),(0,s.bo)((0,s.Lk)("span",R,null,512),[[r.aG,i.success]])]),1===e?((0,s.uX)(),(0,s.CE)("p",F,"alebo")):(0,s.Q3)("",!0),(0,s.Lk)("label",{class:"btn btn-grey",for:"scan_input_"+t.position},[(0,s.eW)((0,T.v_)(1===e?"Vybrať súbor":"Odfotiť a nahrať")+" ",1),(0,s.Lk)("input",{id:"scan_input_"+t.position,name:"scan_input_"+t.position,type:"file",accept:"image/*",capture:"",onChange:a[0]||(a[0]=(...e)=>c.file_change&&c.file_change(...e))},null,40,B)],8,W)],2))),64))],32)}t(4603),t(7566),t(8721);var I={props:{debug:Boolean,position:Number},components:{},emits:["scan_feedback","scan_payload"],data(){return{file:{whole_file:"",valid:!1,name:"",size:"",type:"",url:"",base:""},success:!1}},created(){},methods:{file_change(e){let a={};if("change"===e.type?a=e.target?.files?.[0]:"drop"===e.type&&(a=e.dataTransfer?.files?.[0]),void 0!==a){if(this.file={whole_file:a,valid:!1,name:j.A.slugify_keep_extension_add_tag(a.name,!1),size:a.size,type:a.type,url:URL.createObjectURL(a),base:""},this.scan_validate(),!1===this.file.valid)return this.success=!1,void this.$emit("scan_payload","",this.position);this.convert_base64()}},scan_validate(){this.file.size>15e6?this.$emit("scan_feedback","Súbor je príliš veľký: "+this.file.size+", povolená veľkosť: 15mb"):"image/png"===this.file.type||"image/jpg"===this.file.type||"image/jpeg"===this.file.type?(this.debug&&this.$emit("scan_feedback","file "+this.file.name+" valid"),this.file.valid=!0):this.$emit("scan_feedback","Nepodporovaný typ súboru: "+this.file.type+", povolené typy: .png .jpg .jpeg")},convert_base64(){let e=new FileReader;e.addEventListener("load",(e=>{this.file.base=e.target.result,this.debug&&this.$emit("scan_feedback","converted file "+this.file.name+" to base64"),this.$emit("scan_payload",this.file.base,this.position),this.success=!0})),e.readAsDataURL(this.file.whole_file)}},computed:{},watch:{}};const Z=(0,g.A)(I,[["render",q]]);var J=Z,M={props:{},components:{Modal_body:o.A,Scan_capture:v,Scan_check:D,Scan_feedback:O.A,Scan_upload:J},emits:[],data(){return{feedback:[],debug:!1,side_payloads:{1:"",2:""},active_cameras:{1:!1,2:!1}}},created(){},methods:{scan_payload(e,a){this.side_payloads[a]=e},add_to_feedback(e){this.feedback.push(e)},camera_toggle(e){this.active_cameras[e]=!this.active_cameras[e]}},computed:{},watch:{}};const K=(0,g.A)(M,[["render",c]]);var Q=K}}]);