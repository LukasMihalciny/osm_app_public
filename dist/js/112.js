"use strict";(self["webpackChunkosmapp_webpack_3xx"]=self["webpackChunkosmapp_webpack_3xx"]||[]).push([[112],{3175:function(e,t,a){var s=a(1114),r=a(8700),n=a(2873),o=a(5833),i=a(2754),_=a(3177);class c{constructor(){(0,s.A)(this,"params",{}),(0,s.A)(this,"headers",{}),(0,s.A)(this,"auth_fails",0),(0,s.A)(this,"auth_max",6)}prepare_params(e){return this.params=e,void 0===this.params.timeout&&(this.params.timeout=29),this.headers={method:this.params.method,mode:"cors",cache:"no-cache",credentials:"omit",signal:(0,i.A)().get_abort_signal(),headers:{"x-user-scope":(0,r.A)().give_api_scope(),Authorization:(0,r.A)().give_bearer(),Accept:"application/json"}},"POST"===this.params.method&&this.params.body&&(this.headers.body=this.params.body),void 0===this.params.content_type?this.headers.headers["Content-Type"]="application/x-www-form-urlencoded":null!==this.params.content_type&&(this.headers.headers["Content-Type"]=this.params.content_type),this}async unauthorized(){let e=(0,r.A)().get_backend_type(),t=(0,r.A)().get_endpoint_type(),a=(0,_.A)().get_receiver(),s={php_wrapper:"/authorize_frontend/?endpoint="+t+"&receiver="+a,np_wp:"/wp-content/themes/najpoistenie/api_php_requests/authorize_frontend.php",fp_symfony:"/osmapp/auth/?receiver="+a,np_symfony:"/osmapp/auth/?receiver="+a};if(s.hasOwnProperty(e)){let t=window.location.origin+s[e];return fetch(t).then((e=>e.json())).then((e=>!!e&&((0,r.A)().save_bearer(e),!0)))}if("lukas_local"===e){let e="http://wrapper.local/authorize_frontend/?endpoint="+t+"&receiver="+a;return fetch(e).then((e=>e.json())).then((e=>((0,r.A)().save_bearer(e),console.log("NEW BEARER:"),console.log(e),!0)))}return"vue"===e?(console.log("VUE does not have 401 auth service, fill access_token into env.js"),!1):"myport"===e?(0,r.A)().myport_access_token_promise().then((e=>!1!==e&&((0,r.A)().save_bearer(e),!0))):(console.log("backend_type "+e+" has no access to new authorization"),!1)}async handle_response(){let e=await this.call_the_api_request();if(200===e.status)return this.auth_fails=0,e;if(401===e.status){if(this.auth_fails++,this.auth_fails>this.auth_max)return console.log("Authorization reched maximum attempts. Try to refresh the app or report to admin."),{};let e=await this.unauthorized();return e?await this.prepare_params(this.params).handle_response():null}if(423===e.status&&-1===["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name))return(0,n.A)().open_it("Clearance"),e;if(503===e.status)return(0,r.A)().change_step(503),e;if(408===e.status)return console.log("408 in request "+this.params.action_name),-1===["calculate_step2","calculate_step4","confirm"].indexOf(this.params.action_name)&&(0,n.A)().open_it("Server_timeout"),e;if(500===e.status&&"calculate_step2"===this.params.action_name||422===e.status&&"confirm"===this.params.action_name||412===e.status&&"confirm"===this.params.action_name||422===e.status&&"getsessioninfo"===this.params.action_name||"ico-info"===this.params.action_name||["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name)>-1||422===e.status&&"session-remap"===this.params.action_name||422===e.status&&"id-scan/add-page"===this.params.action_name||422===e.status&&"id-scan/get-scan-groups"===this.params.action_name||(422===e.status||409===e.status)&&"signature-code-check"===this.params.action_name||(422===e.status||409===e.status)&&"signature-code-send"===this.params.action_name||500===e.status&&"id-scan/get-scan-groups"===this.params.action_name||425===e.status&&"id-scan/get-scan-groups"===this.params.action_name||425===e.status&&"id-scan/get-scan-group-documents"===this.params.action_name||422===e.status&&"payment-create"===this.params.action_name||422===e.status&&"offer-notify"===this.params.action_name)return e;{let t=(new Date).toLocaleString(),a=(0,r.A)().get_session_token(),s=(0,r.A)().current_step();return(0,o.A)().set_last_request(this.headers,this.params,t,a,s,e),(0,r.A)().change_step(404),(0,n.A)().close_them_all(),e}}call_the_api_request(){return new Promise(((e,t)=>{let a=setTimeout((function(){return e({status:408,statusText:"Request Timeout"})}),1e3*this.params.timeout),s={};fetch(this.params.url,this.headers).then((e=>{s=e;let t=e.headers.get("content-type");return-1===t.indexOf("json")?{response:"not in json format"}:e.json()})).then((t=>{s.result=t,e(s)})).catch((e=>{"AbortError"===e.name?(clearTimeout(a),console.log("abort",this.params.action_name)):console.error("Fetch error:",e)}))}))}}t.A=c},3790:function(e,t,a){a.r(t),a.d(t,{default:function(){return T}});var s=a(641),r=a(33);const n={class:"row pb-3 advanced_settings_nav"},o={class:"col-6"},i=["onClick"],_={class:"col-3 text-end"},c={class:"col-3 text-end"},d={class:"row mt-4"},u={class:"col-9 text-end"},l={class:"col-3 text-end"};function p(e,t,a,p,h,m){const v=(0,s.g2)("Bouncer_loading"),f=(0,s.g2)("Tabs"),A=(0,s.g2)("Modal_body");return(0,s.uX)(),(0,s.Wv)(A,{close:!1,title:h.product_name,class:"",huge:!0},{default:(0,s.k6)((()=>[(0,s.Lk)("div",n,[(0,s.Lk)("div",o,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.tab_count,((e,t)=>((0,s.uX)(),(0,s.CE)("button",{onClick:t=>m.switch_the_tab(e),class:(0,r.C4)(["btn btn-sm btn-secondary me-5",m.current_person===e?"active":"faded"])},(0,r.v_)(t+1)+". poistený ",11,i)))),256))]),(0,s.Lk)("div",_,[(0,s.Lk)("button",{class:"btn btn-sm btn-secondary btn-left",onClick:t[0]||(t[0]=(...e)=>m.return_to_step1&&m.return_to_step1(...e))},(0,r.v_)(m.first_person?"Návrat na vstup":"Naspäť"),1)]),(0,s.Lk)("div",c,[h.loading?((0,s.uX)(),(0,s.Wv)(v,{key:0,style:{"margin-top":"10px"}})):((0,s.uX)(),(0,s.CE)("button",{key:1,class:"btn btn-sm btn-primary btn-right",onClick:t[1]||(t[1]=(...e)=>m.validate_extended&&m.validate_extended(...e))},(0,r.v_)(m.last_person?"Prepočítať produkt":"Pokračovať"),1))])]),(0,s.bF)(f),(0,s.Lk)("div",d,[(0,s.Lk)("div",u,[(0,s.Lk)("button",{class:"btn btn-sm btn-secondary btn-left",onClick:t[2]||(t[2]=(...e)=>m.return_to_step1&&m.return_to_step1(...e))},(0,r.v_)(m.first_person?"Návrat na vstup":"Naspäť"),1)]),(0,s.Lk)("div",l,[h.loading?((0,s.uX)(),(0,s.Wv)(v,{key:0,style:{"margin-top":"10px"}})):((0,s.uX)(),(0,s.CE)("button",{key:1,class:"btn btn-sm btn-primary btn-right",onClick:t[3]||(t[3]=(...e)=>m.validate_extended&&m.validate_extended(...e))},(0,r.v_)(m.last_person?"Prepočítať produkt":"Pokračovať"),1))])])])),_:1},8,["title"])}a(4979),a(1678);var h=a(8384),m=a(2873),v=a(3177),f=a(6460),A=a(8700),b=a(6343),g=a(3175);class k{validate_extended_form(){let e={action_name:"validategroupform",method:"POST",body:b.A.serialize_user_input(),url:(0,A.A)().endpoint_url()+"online/validategroupform/"+(0,A.A)().product_group_id()+"/?global=0&without_form=1"};e.url+=b.A.add_token_as_parameter();let t=new g.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}}var y=new k,x=a(55),w=a(7247),C=a(9614),L={props:{},components:{Bouncer_loading:x.A,Modal_body:h.A,Tabs:w.A},data(){return{extended_inputs:{},extended_errors:null,product_name:"",product_id:0,period:0,loading:!1}},created(){this.extended_inputs=(0,m.A)().retrieve_modal_data().extended_inputs,this.extended_errors=(0,m.A)().retrieve_modal_data().extended_errors,this.product_name=(0,m.A)().retrieve_modal_data().product_name,this.product_id=(0,m.A)().retrieve_modal_data().product_id,this.period=(0,m.A)().retrieve_modal_data().period,(0,v.A)().insert_product_values(this.extended_inputs),(0,f.A)().set_form(this.extended_inputs),null!==this.extended_errors&&(0,f.A)().set_errors(structuredClone(this.extended_errors)),(0,C.A)().set_tab_keys(this.extended_inputs)},methods:{return_to_step1(){this.first_person?((0,f.A)().clear_form(),(0,v.A)().reset_form_values(),(0,f.A)().clear_errors(),(0,C.A)().reset_tab_keys(),(0,A.A)().change_step(1)):((0,C.A)().decrease_tab(),b.A.this_tab_is_empty()&&this.return_to_step1())},validate_extended(){this.loading=!0,y.validate_extended_form().then((e=>{this.loading=!1,200===e.status&&((0,f.A)().clear_errors(),this.process_errors_and_go_further(e))}))},process_errors_and_go_further(e){if((0,C.A)().current_tab_is_last())!0===e.result.validform?((0,f.A)().clear_form(),(0,v.A)().reset_form_values(),(0,C.A)().reset_tab_keys(),(0,m.A)().set_modal_event_data(this.product_id),(0,m.A)().close_them_all()):((0,f.A)().set_errors(e.result.form_validation_error_elements),(0,C.A)().open_first_tab_with_error(e.result.form_validation_error_tab_elements),b.A.adjust_view(!0));else{let t=e.result.form_validation_error_tab_elements?.[(0,C.A)().get_current_tab()];void 0===t?((0,C.A)().increase_tab(),b.A.this_tab_is_empty()&&this.process_errors_and_go_further(e),b.A.adjust_view()):((0,f.A)().set_errors(t),b.A.adjust_view(!0))}},switch_the_tab(e){(0,C.A)().set_current_tab(e)}},computed:{tab_count(){return(0,C.A)().get_tab_keys()},first_person(){return(0,C.A)().current_tab_is_first()},last_person(){return(0,C.A)().current_tab_is_last()},current_person(){return(0,C.A)().get_current_tab()}}},E=a(6262);const j=(0,E.A)(L,[["render",p]]);var T=j},8384:function(e,t,a){a.d(t,{A:function(){return p}});var s=a(641),r=a(33);const n={class:"modal-content"},o={class:"modal-header"},i={class:"modal-body"};function _(e,t,a,_,c,d){return(0,s.uX)(),(0,s.CE)("div",{onClick:t[1]||(t[1]=(...e)=>d.did_click_outside&&d.did_click_outside(...e)),class:(0,r.C4)(["vue_modal",a.huge?"huge":""]),"data-cy":"modal"},[(0,s.Lk)("div",n,[(0,s.Lk)("div",o,[(0,s.Lk)("h4",null,(0,r.v_)(a.title),1),a.close?((0,s.uX)(),(0,s.CE)("span",{key:0,onClick:t[0]||(t[0]=(...e)=>d.close_me&&d.close_me(...e)),class:"i_close"})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",i,[(0,s.RG)(e.$slots,"default")])])],2)}var c=a(2873),d={props:{close:Boolean,title:String,huge:Boolean},components:{},emits:[],data(){return{}},created(){document.addEventListener("keyup",this.close_me)},beforeUnmount(){document.removeEventListener("keyup",this.close_me)},methods:{close_me(e){this.close&&("click"===e?.type||"keyup"===e?.type&&27===e?.keyCode)&&(0,c.A)().close_them_all()},did_click_outside(e){e.target.classList.contains("vue_modal")&&this.close_me(e)}},computed:{},watch:{}},u=a(6262);const l=(0,u.A)(d,[["render",_]]);var p=l}}]);