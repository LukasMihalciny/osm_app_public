"use strict";(self["webpackChunkosmapp_webpack_2xx"]=self["webpackChunkosmapp_webpack_2xx"]||[]).push([[907],{4326:function(e,t,r){var s=r(8700),n=r(6343),a=r(3175),o=r(3177);class _{get_calculate(e,t,r){let o={action_name:"calculate_step2",method:"POST",url:(0,s.A)().endpoint_url()+"online/calculate/?id="+e+"&json=1&period="+r+n.A.add_token_as_parameter(),body:t},_=new a.A;return _.prepare_params(o).handle_response().then((t=>408===t.status?(console.log("#"+e+" has 408, going for results request"),this.repeat_results()):t)).catch((e=>{throw e}))}check_calculate(){let e={action_name:"calculate_step4",method:"POST",url:(0,s.A)().endpoint_url()+"online/calculate/?"+n.A.add_token_as_parameter(),body:null};e.url+="&id="+(0,o.A)().get_selected_product().product_id+"&period="+(0,o.A)().get_selected_product().period;let t=new a.A;return t.prepare_params(e).handle_response().then((async e=>408===e.status?(console.log("calculate has 408 timeout, wait 1 minute and run results api"),await n.A.sleep(60),this.repeat_results()):e)).catch((e=>{throw e}))}repeat_results(){let e={action_name:"results",method:"GET",url:(0,s.A)().endpoint_url()+"online/results/?"+n.A.add_token_as_parameter()},t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}}t.A=new _},9452:function(e,t,r){var s=r(8700),n=r(6343),a=r(3175);class o{session_info(){let e={action_name:"getsessioninfo",method:"GET",url:(0,s.A)().endpoint_url()+"online/getsessioninfo/?"+n.A.add_token_as_parameter()},t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}get_data(){let e={action_name:"getdata",method:"GET",url:(0,s.A)().endpoint_url()+"online/getdata/?"+n.A.add_token_as_parameter()},t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}set_data(e){let t={action_name:"setdata",method:"POST",url:(0,s.A)().endpoint_url()+"online/setdata/?"+n.A.serialize_object(e)+n.A.add_token_as_parameter()},r=new a.A;return r.prepare_params(t).handle_response().catch((e=>{throw e}))}}t.A=new o},6492:function(e,t,r){r.r(t),r.d(t,{default:function(){return H}});var s=r(641),n=r(3751),a=r(33);const o={"data-cy":"calc_proposal"},_=["innerHTML"],i=["innerHTML"],l={class:"text-center pt-2 pb-5"},c=(0,s.Lk)("h3",null,"Načítavame dokumenty",-1),d={key:0,class:"prop_confirm mb-4"},u=(0,s.Lk)("h5",{class:"text-warning"},"Upozornenie",-1),p=(0,s.Lk)("span",{class:"proposal_scroll_anchor"},null,-1);function m(e,t,r,m,h,g){const A=(0,s.g2)("Title"),f=(0,s.g2)("Documents_prepare"),v=(0,s.g2)("Bouncer_loading"),k=(0,s.g2)("Confirm_form"),b=(0,s.g2)("Singnature_form");return(0,s.uX)(),(0,s.CE)("section",o,[(0,s.bF)(A,{title:"Takmer hotovo!"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",{innerHTML:h.html.view_header_text},null,8,_)])),_:1}),(0,s.Lk)("div",{innerHTML:h.html.contract_html,class:"prop_wording","data-cy":"proposal_template"},null,8,i),(0,s.bF)(f,{start_doc_requests:h.start_doc_requests,onAll_docs_finished:g.all_docs_finished,step_html:4},null,8,["start_doc_requests","onAll_docs_finished"]),(0,s.bo)((0,s.Lk)("div",l,[c,(0,s.bF)(v)],512),[[n.aG,!h.doc_requests_are_done]]),h.warning?(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",d,[u,(0,s.Lk)("p",null,(0,a.v_)(h.warning),1)],512)),[[n.aG,h.doc_requests_are_done]]):(0,s.Q3)("",!0),p,0===h.signature_required&&h.doc_requests_are_done?((0,s.uX)(),(0,s.Wv)(k,{key:1})):1===h.signature_required&&h.doc_requests_are_done?((0,s.uX)(),(0,s.Wv)(b,{key:2})):(0,s.Q3)("",!0)])}var h=r(9452),g=r(4326),A=r(8856),f=r(55),v=r(2873),k=r(3177),b=r(821),w=r(9713);const x={class:"prop_confirm","data-cy":"acceptance_form"},q=(0,s.Lk)("h3",{class:"text-primary"}," Záverečné potvrdenie ",-1);function y(e,t,r,n,a,o){const _=(0,s.g2)("Confirm_checkboxes"),i=(0,s.g2)("Confirm_buttons");return(0,s.uX)(),(0,s.CE)("div",x,[q,(0,s.bF)(_,{mode:"classic",invalid_checkboxes:a.invalid_checkboxes},null,8,["invalid_checkboxes"]),(0,s.bF)(i,{mode:"classic",allow_back:!0,loading:a.confirm_running,onMain_button_press:o.main_button_press},null,8,["loading","onMain_button_press"])])}var j=r(4430),T=r(1391),L=r(7654),C=r(8700),P=r(6460),O={props:{},components:{Confirm_checkboxes:j.A,Confirm_buttons:T.A},emits:[],data(){return{confirm_running:!1,invalid_checkboxes:!1}},created(){},methods:{main_button_press(){this.invalid_checkboxes=(0,P.A)().are_checkboxes_invalid(),this.invalid_checkboxes||this.run_confirm()},run_confirm(){this.confirm_running=!0,L.A.confirm_session(!0).then((e=>{if(this.confirm_running=!1,200===e.status&&("success"===e.result?.response||100===e.result?.state))return(0,P.A)().$reset(),void(0,C.A)().change_step(5);(0,v.A)().store_modal_data({type:"confirm_step4_didnt_succeed",errors:e.result?.data?.errors||{message:e.result?.message}}),(0,v.A)().open_it("Ordinary_error_modal")}))}},computed:{},watch:{}},E=r(6262);const M=(0,E.A)(O,[["render",y]]);var F=M,G=r(2765),S={props:{},components:{Documents_prepare:b.A,Bouncer_loading:f.A,Title:w.A,Confirm_form:F,Singnature_form:G.A},data(){return{debug:!1,start_doc_requests:!1,doc_requests_are_done:!1,signature_required:0,html:{contract_html:"",view_header_text:""},warning:void 0}},created(){Promise.resolve().then((()=>h.A.session_info())).then((e=>{if(e.result?.state>=100)return(0,C.A)().change_step(5),Promise.reject("session already confirmed");this.signature_required=e.result?.signature_required,console.log("signature_required",e.result?.signature_required)})).then((()=>h.A.get_data())).then((e=>200!==e.status?Promise.reject("get_data api failed"):((0,k.A)().extract_selected_product(e),(0,k.A)().store_call_params(e.result?.call_params),this.debug?(this.doc_requests_are_done=!0,Promise.reject("debug prevent calculate")):g.A.check_calculate()))).then((e=>{let t=(0,k.A)().get_selected_product().product_id;return this.warning=e.result[t]?.result?.result?.warning?.result,!1===e.result.validform?((0,v.A)().store_modal_data({type:"calculate_step4_validate_form_didnt_pass",errors:e.result?.form_validation_error_elements}),(0,v.A)().open_it("Ordinary_error_modal"),Promise.reject("prevent documents, validform false")):void 0!==e.result[t]?.result?.errors?((0,v.A)().store_modal_data({type:"calculate_step4_webservice_didnt_accept_form",errors:e.result[t]?.result?.errors}),(0,v.A)().open_it("Ordinary_error_modal"),Promise.reject("prevent documents, webservice rejected")):200!==e.status?((0,v.A)().store_modal_data({type:"calculate_step4_unexpected_response_code",errors:null}),(0,v.A)().open_it("Ordinary_error_modal"),Promise.reject("prevent documents, response code")):void 0})).then((()=>{A.A.get_it(!1).then((e=>{this.html.contract_html=e.result?.html})),A.A.get_json_api("view_header_text").then((e=>{if(0===this.signature_required)this.html.view_header_text=e.result?.json?.both;else{let t=(0,C.A)().get_signature_role();this.html.view_header_text="poistnik"===t?e.result?.json?.client:e.result?.json?.agent}})),this.start_doc_requests=!0})).catch((e=>{console.log(e)}))},methods:{all_docs_finished(){this.doc_requests_are_done=!0}},computed:{},watch:{}};const X=(0,E.A)(S,[["render",m]]);var H=X}}]);