"use strict";(self["webpackChunkosmapp_webpack_3x25x"]=self["webpackChunkosmapp_webpack_3x25x"]||[]).push([[873],{55:function(e,t,a){a.d(t,{A:function(){return _}});var s=a(641),n=a(33);const o={class:"spinner"};function r(e,t,a,r,i,c){return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",{class:(0,n.C4)(["bounce1",a.size])},null,2),(0,s.Lk)("div",{class:(0,n.C4)(["bounce2",a.size])},null,2),(0,s.Lk)("div",{class:(0,n.C4)(["bounce3",a.size])},null,2)])}var i={props:{size:String},components:{},data(){return{}},created(){},methods:{},computed:{}},c=a(6262);const p=(0,c.A)(i,[["render",r]]);var _=p},1786:function(e,t,a){a.d(t,{A:function(){return g}});var s=a(641),n=a(3751);const o={key:0,class:"row mt-4 form-pagination","data-cy":"navigation"},r={class:"col-12 col-sm-4 text-center text-sm-start order-2 order-sm-1"},i={class:"col-12 col-sm-4 text-center order-3 order-sm-2"},c={class:"col-12 col-sm-4 text-center text-sm-end order-1 order-sm-3"},p=["disabled","title"];function _(e,t,a,_,l,u){const h=(0,s.g2)("Bouncer_loading");return u.completely_hide_bottom_nav?((0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",r,[a.show_back?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>u.prev&&u.prev(...e)),type:"button",class:"btn btn-light btn-left btn-lg"}," Naspäť ")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",i,[(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>u.clear&&u.clear(...e)),type:"button",class:"btn btn-white btn-lg"}," Vymazať údaje ")]),(0,s.Lk)("div",c,[(0,s.bo)((0,s.bF)(h,null,null,512),[[n.aG,u.loading]]),a.show_next?(0,s.bo)(((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[2]||(t[2]=(...e)=>u.next&&u.next(...e)),disabled:a.disable_next,title:a.disable_next?"Pokúšame sa zopakovať požiadavku.":"",type:"button",class:"btn btn-primary btn-right btn-lg"}," Pokračovať ",8,p)),[[n.aG,!u.loading]]):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)}var l=a(55),u=a(2873),h=a(8700),m={props:{show_back:Boolean,show_next:Boolean,disable_next:Boolean},components:{Bouncer_loading:l.A},emits:["next","prev"],data(){return{}},created(){},methods:{next(){this.$emit("next")},prev(){this.$emit("prev")},clear(){(0,u.A)().open_it("Cleaning_session")}},computed:{loading(){return(0,u.A)().is_loading()},completely_hide_bottom_nav(){return!["np_symfony","fp_symfony"].includes((0,h.A)().get_backend_type())||!this.loading}}},d=a(6262);const f=(0,d.A)(m,[["render",_]]);var g=f},3175:function(e,t,a){var s=a(1114),n=a(8700),o=a(2873),r=a(5833),i=a(2754),c=a(3177),p=a(9885);class _{constructor(){(0,s.A)(this,"params",{}),(0,s.A)(this,"headers",{}),(0,s.A)(this,"auth_fails",0),(0,s.A)(this,"auth_max",6)}prepare_params(e){return this.params=e,void 0===this.params.timeout&&(this.params.timeout=29),this.headers={method:this.params.method,mode:"cors",cache:"no-cache",credentials:"omit",signal:(0,i.A)().get_abort_signal(),headers:{"x-user-scope":(0,n.A)().give_api_scope(),Authorization:(0,n.A)().give_bearer(),Accept:"application/json"}},"POST"===this.params.method&&this.params.body&&(this.headers.body=this.params.body),void 0===this.params.content_type?this.headers.headers["Content-Type"]="application/x-www-form-urlencoded":null!==this.params.content_type&&(this.headers.headers["Content-Type"]=this.params.content_type),this}async unauthorized(){let e=(0,n.A)().get_backend_type(),t=(0,n.A)().get_endpoint_type(),a=(0,c.A)().get_receiver(),s=await p.A.captcha_api(),o={php_wrapper:"/authorize_frontend/?endpoint="+t+"&receiver="+a+"&cache=no",np_wp:"/wp-content/themes/najpoistenie/api_php_requests/authorize_frontend.php",fp_symfony:"/osmapp/auth/?receiver="+a+"&cache=no",np_symfony:"/osmapp/auth/?captcha="+s+"&cache=no",wrapper_sf:"/osmapp/auth/?endpoint="+t+"&receiver="+a+"&cache=no"};if(o.hasOwnProperty(e)){let t=window.location.origin+o[e];return fetch(t).then(e=>e.json()).then(e=>!!e&&((0,n.A)().save_bearer(e),!0))}if("lukas_local"===e){let e="http://wrapper.local/authorize_frontend/?endpoint="+t+"&receiver="+a;return fetch(e).then(e=>e.json()).then(e=>((0,n.A)().save_bearer(e),!0))}return"vue"===e?(console.log("VUE does not have 401 auth service, fill access_token into env.js"),!1):"myport"===e?(0,n.A)().myport_access_token_promise().then(e=>!1!==e&&((0,n.A)().save_bearer(e),!0)):(console.log("backend_type "+e+" has no access to new authorization"),!1)}async switch_receiver(){let e=(0,n.A)().get_backend_type(),t=(0,n.A)().get_endpoint_type(),a=(0,c.A)().get_receiver(),s=await p.A.captcha_api(),o={lukas_local:"http://wrapper.local/authorize_frontend/?endpoint="+t+"&receiver="+a+"&cache=allow",wrapper_sf:window.location.origin+"/osmapp/auth/?endpoint="+t+"&receiver="+a+"&cache=allow",php_wrapper:window.location.origin+"/authorize_frontend/?endpoint="+t+"&receiver="+a+"&cache=allow",fp_symfony:window.location.origin+"/osmapp/auth/?receiver="+a+"&cache=allow",np_symfony:window.location.origin+"/osmapp/auth/?captcha="+s+"&cache=allow"};if("vue"===e)return!0;if(!o.hasOwnProperty(e))return console.log("backend_type "+e+" cant authorize itself"),!1;let r=o[e];return fetch(r).then(e=>e.json()).then(e=>!!e&&((0,n.A)().save_bearer(e),!0))}async handle_response(){let e=await this.call_the_api_request();if(200===e.status)return this.auth_fails=0,e;if(401===e.status){if(this.auth_fails++,this.auth_fails>this.auth_max)return console.log("Authorization reched maximum attempts. Try to refresh the app or report to admin."),{};let e=await this.unauthorized();return e?await this.prepare_params(this.params).handle_response():null}if(423===e.status&&-1===["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name))return(0,o.A)().open_it("Clearance"),e;if(503===e.status)return(0,n.A)().set_overseer_view(503),e;if(408===e.status)return console.log("408 in request "+this.params.action_name),-1===["calculate_step2","calculate_step4","confirm"].indexOf(this.params.action_name)&&(0,o.A)().open_it("Server_timeout"),e;if(500===e.status&&"calculate_step2"===this.params.action_name||422===e.status&&"confirm"===this.params.action_name||412===e.status&&"confirm"===this.params.action_name||422===e.status&&"getsessioninfo"===this.params.action_name||"ico-info"===this.params.action_name||["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name)>-1||422===e.status&&"session-remap"===this.params.action_name||422===e.status&&"id-scan/add-page"===this.params.action_name||422===e.status&&"id-scan/get-scan-groups"===this.params.action_name||422===e.status&&"identity-scan-check"===this.params.action_name||422===e.status&&"identity-scan"===this.params.action_name||(422===e.status||409===e.status)&&"signature-code-check"===this.params.action_name||(422===e.status||409===e.status)&&"signature-code-send"===this.params.action_name||500===e.status&&"id-scan/get-scan-groups"===this.params.action_name||425===e.status&&"id-scan/get-scan-groups"===this.params.action_name||425===e.status&&"id-scan/get-scan-group-documents"===this.params.action_name||422===e.status&&"payment-create"===this.params.action_name||422===e.status&&"offer-notify"===this.params.action_name)return e;{let t=(new Date).toLocaleString(),a=(0,n.A)().get_session_token(),s=(0,n.A)().current_step();return(0,r.A)().set_last_request(this.headers,this.params,t,a,s,e),(0,n.A)().set_overseer_view(404),(0,o.A)().close_them_all(),e}}call_the_api_request(){return new Promise((e,t)=>{let a=setTimeout(function(){return e({status:408,statusText:"Request Timeout"})},1e3*this.params.timeout),s={};fetch(this.params.url,this.headers).then(e=>{s=e;let t=e.headers.get("content-type");return-1===t.indexOf("json")?{response:"not in json format"}:e.json()}).then(t=>{s.result=t,e(s)}).catch(e=>{"AbortError"===e.name?(clearTimeout(a),console.log("abort",this.params.action_name)):console.error("Fetch error:",e)})})}}t.A=_},7654:function(e,t,a){var s=a(8700),n=a(6343),o=a(3175),r=a(5833),i=a(6460);class c{confirm_session(e){let t="";e&&(t=(0,i.A)().get_confirm_chbs(),t=n.A.serialize_object(t));let a={action_name:"confirm",method:"GET",url:(0,s.A)().endpoint_url()+"online/confirm/?"+t+n.A.add_token_as_parameter()},r=new o.A;return r.prepare_params(a).handle_response().then(e=>408===e.status||412===e.status?this.repeat_getsessioninfo(0):e).catch(e=>{throw e})}repeat_confirm(){let e={action_name:"confirm",method:"GET",url:(0,s.A)().endpoint_url()+"online/confirm/?"+n.A.add_token_as_parameter()},t=new o.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}async repeat_getsessioninfo(e){e++;let t=10,a=10;console.log("wait "+a+" seconds then try getsessioninfo, iteration: "+e+" (max "+t+")"),await n.A.sleep(a);let i={action_name:"getsessioninfo",method:"GET",url:(0,s.A)().endpoint_url()+"online/getsessioninfo/?"+n.A.add_token_as_parameter()},c=new o.A;return c.prepare_params(i).handle_response().then(a=>{if(100===a.result?.state)return a;if(e>=t){let e=(new Date).toLocaleString(),t=(0,s.A)().get_session_token(),n=(0,s.A)().current_step();return(0,r.A)().set_last_request({},i,e,t,n,a),(0,s.A)().set_overseer_view(404),{status:408,action_name:"getsessioninfo"}}return this.repeat_getsessioninfo(e)}).catch(e=>{throw e})}}t.A=new c},8873:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});var s=a(641),n=a(33);const o={"data-cy":"error_page"},r={class:"text-center pt-5"},i={key:0},c={class:"text-primary"},p={class:"text-primary"},_={class:"mb-5"},l={key:1,class:"text-center"};function u(e,t,a,u,h,m){const d=(0,s.g2)("Navigation");return(0,s.uX)(),(0,s.CE)("section",o,[(0,s.Lk)("div",r,[t[2]||(t[2]=(0,s.Lk)("h1",null," Ľutujeme, niečo sa nepodarilo :( ",-1)),t[3]||(t[3]=(0,s.Lk)("p",null,[(0,s.eW)(" Vyskytla sa neočakávaná chyba, preto nebolo možné dokončiť operáciu."),(0,s.Lk)("br"),(0,s.eW)(" Pre informácie ohľadom ďalšieho postupu nás prosím kontaktujte. ")],-1)),m.phone?((0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("h3",c,(0,n.v_)(m.phone),1),t[1]||(t[1]=(0,s.Lk)("p",null," Volajte kedykoľvek pondelok až piatok 09:00 - 17:00 ",-1))])):(0,s.Q3)("",!0),(0,s.Lk)("h3",p,(0,n.v_)(m.email),1),t[4]||(t[4]=(0,s.Lk)("p",null," Pošlite nám fotku tejto obrazovky a ozveme sa vám. ",-1))]),(0,s.Lk)("pre",_,(0,n.v_)(m.error),1),m.form_app_mode?((0,s.uX)(),(0,s.Wv)(d,{key:0,onPrev:m.prev_button,onNext:m.next_button,show_back:!0,show_next:!0,disable_next:h.disable_next},null,8,["onPrev","onNext","disable_next"])):(0,s.Q3)("",!0),m.form_app_mode?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>m.open_where&&m.open_where(...e)),class:"btn btn-outline-primary mt-5"}," Zotavenie session ")])):(0,s.Q3)("",!0)])}var h=a(1786),m=a(5833),d=a(9819),f=a(8700),g=a(9452),A=a(7654),v=a(2873),w=(a(6343),a(3175)),b=a(3177);class k{grafana(){let e=(0,m.A)().get_detailed_fail(),t={message:"osmapp: "+e.action_name+" failed",level_name:"DEBUG",type:"frontend",context:{failed_api:e,app_state:{version:(0,f.A)().give_app_version(),session_token:(0,f.A)().get_session_token(),endpoint_type:(0,f.A)().get_endpoint_type(),run_mode:(0,f.A)().get_run_mode(),backend_type:(0,f.A)().get_backend_type(),group_id:(0,f.A)().product_group_id(),step:e.step,flow_id:(0,f.A)().get_flow_id(),signature_role:(0,f.A)().get_signature_role(),payment:(0,f.A)().get_payment_data(),representative:(0,f.A)().get_representative(),agent_code:(0,b.A)().get_agent_code(),selected_product:(0,b.A)().get_selected_product()}},request_uri:window.location.href,module_fqdn:window.location.hostname},a={action_name:"logger",method:"POST",body:JSON.stringify(t),url:(0,f.A)().grafana_url(),content_type:"application/json"},s=new w.A;return s.prepare_params(a).handle_response().catch(e=>{throw e})}}var y=new k,x={props:{},components:{Navigation:h.A},emits:[],data(){return{session_state:0,disable_next:!0,attempt:0,timeout_handle:"",fast_tries:1,slow_tries:2,last_tries:1,fast_timer:10,slow_timer:20,last_timer:50}},created(){y.grafana(),this.set_continue_timer()},beforeUnmount(){clearTimeout(this.timeout_handle)},methods:{prev_button(){clearTimeout(this.timeout_handle),(0,f.A)().change_step(this.error.step)},next_button(){100!==this.session_state?A.A.repeat_confirm().then(e=>{"success"!==e.result?.response&&100!==e.result?.state||(0,f.A)().change_step(5)}):(0,f.A)().change_step(5)},set_continue_timer(){if(!this.form_app_mode)return;if(this.attempt++,this.attempt>this.fast_tries+this.slow_tries+this.last_tries)return void console.log("continue_session reached max tries");let e=this.attempt>this.fast_tries+this.slow_tries?this.last_timer:this.attempt>this.fast_tries?this.slow_timer:this.fast_timer;e*=1e3,this.timeout_handle=setTimeout(()=>{this.continue_session()},e)},continue_session(){g.A.session_info().then(e=>{200===e.status?"success"===e.result?.response||100===e.result?.state?(this.session_state=100,this.disable_next=!1):90===e.result?.state?(this.session_state=90,this.disable_next=!1):this.set_continue_timer():console.log("getsessioninfo failed")})},open_where(){clearTimeout(this.timeout_handle),(0,v.A)().open_it("Resurrect_session")}},computed:{error(){return(0,m.A)().get_last_request()},email(){return d.A.email_address()},phone(){return d.A.phone_number()},form_app_mode(){return"form_app"===(0,f.A)().get_run_mode()}},watch:{}},z=a(6262);const C=(0,z.A)(x,[["render",u]]);var L=C},9452:function(e,t,a){var s=a(8700),n=a(6343),o=a(3175);class r{session_info(){let e={action_name:"getsessioninfo",method:"GET",url:(0,s.A)().endpoint_url()+"online/getsessioninfo/?"+n.A.add_token_as_parameter()},t=new o.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}get_data(){let e={action_name:"getdata",method:"GET",url:(0,s.A)().endpoint_url()+"online/getdata/?"+n.A.add_token_as_parameter()},t=new o.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}set_data(e){let t={action_name:"setdata",method:"POST",url:(0,s.A)().endpoint_url()+"online/setdata/?"+n.A.serialize_object(e)+n.A.add_token_as_parameter()},a=new o.A;return a.prepare_params(t).handle_response().catch(e=>{throw e})}}t.A=new r}}]);