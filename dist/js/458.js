"use strict";(self["webpackChunkosmapp_webpack_3xx"]=self["webpackChunkosmapp_webpack_3xx"]||[]).push([[458],{3175:function(e,t,a){var s=a(1114),n=a(8700),r=a(2873),o=a(5833),i=a(2754),c=a(3177);class p{constructor(){(0,s.A)(this,"params",{}),(0,s.A)(this,"headers",{}),(0,s.A)(this,"auth_fails",0),(0,s.A)(this,"auth_max",6)}prepare_params(e){return this.params=e,void 0===this.params.timeout&&(this.params.timeout=29),this.headers={method:this.params.method,mode:"cors",cache:"no-cache",credentials:"omit",signal:(0,i.A)().get_abort_signal(),headers:{"x-user-scope":(0,n.A)().give_api_scope(),Authorization:(0,n.A)().give_bearer(),Accept:"application/json"}},"POST"===this.params.method&&this.params.body&&(this.headers.body=this.params.body),void 0===this.params.content_type?this.headers.headers["Content-Type"]="application/x-www-form-urlencoded":null!==this.params.content_type&&(this.headers.headers["Content-Type"]=this.params.content_type),this}async unauthorized(){let e=(0,n.A)().get_backend_type(),t=(0,n.A)().get_endpoint_type(),a=(0,c.A)().get_receiver(),s={php_wrapper:"/authorize_frontend/?endpoint="+t+"&receiver="+a,np_wp:"/wp-content/themes/najpoistenie/api_php_requests/authorize_frontend.php",fp_symfony:"/osmapp/auth/?receiver="+a,np_symfony:"/osmapp/auth/?receiver="+a};if(s.hasOwnProperty(e)){let t=window.location.origin+s[e];return fetch(t).then((e=>e.json())).then((e=>!!e&&((0,n.A)().save_bearer(e),!0)))}if("lukas_local"===e){let e="http://wrapper.local/authorize_frontend/?endpoint="+t+"&receiver="+a;return fetch(e).then((e=>e.json())).then((e=>((0,n.A)().save_bearer(e),console.log("NEW BEARER:"),console.log(e),!0)))}return"vue"===e?(console.log("VUE does not have 401 auth service, fill access_token into env.js"),!1):"myport"===e?(0,n.A)().myport_access_token_promise().then((e=>!1!==e&&((0,n.A)().save_bearer(e),!0))):(console.log("backend_type "+e+" has no access to new authorization"),!1)}async handle_response(){let e=await this.call_the_api_request();if(200===e.status)return this.auth_fails=0,e;if(401===e.status){if(this.auth_fails++,this.auth_fails>this.auth_max)return console.log("Authorization reched maximum attempts. Try to refresh the app or report to admin."),{};let e=await this.unauthorized();return e?await this.prepare_params(this.params).handle_response():null}if(423===e.status&&-1===["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name))return(0,r.A)().open_it("Clearance"),e;if(503===e.status)return(0,n.A)().change_step(503),e;if(408===e.status)return console.log("408 in request "+this.params.action_name),-1===["calculate_step2","calculate_step4","confirm"].indexOf(this.params.action_name)&&(0,r.A)().open_it("Server_timeout"),e;if(500===e.status&&"calculate_step2"===this.params.action_name||422===e.status&&"confirm"===this.params.action_name||412===e.status&&"confirm"===this.params.action_name||422===e.status&&"getsessioninfo"===this.params.action_name||"ico-info"===this.params.action_name||["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name)>-1||422===e.status&&"session-remap"===this.params.action_name||422===e.status&&"id-scan/add-page"===this.params.action_name||422===e.status&&"id-scan/get-scan-groups"===this.params.action_name||(422===e.status||409===e.status)&&"signature-code-check"===this.params.action_name||(422===e.status||409===e.status)&&"signature-code-send"===this.params.action_name||500===e.status&&"id-scan/get-scan-groups"===this.params.action_name||425===e.status&&"id-scan/get-scan-groups"===this.params.action_name||425===e.status&&"id-scan/get-scan-group-documents"===this.params.action_name||422===e.status&&"payment-create"===this.params.action_name||422===e.status&&"offer-notify"===this.params.action_name)return e;{let t=(new Date).toLocaleString(),a=(0,n.A)().get_session_token(),s=(0,n.A)().current_step();return(0,o.A)().set_last_request(this.headers,this.params,t,a,s,e),(0,n.A)().change_step(404),(0,r.A)().close_them_all(),e}}call_the_api_request(){return new Promise(((e,t)=>{let a=setTimeout((function(){return e({status:408,statusText:"Request Timeout"})}),1e3*this.params.timeout),s={};fetch(this.params.url,this.headers).then((e=>{s=e;let t=e.headers.get("content-type");return-1===t.indexOf("json")?{response:"not in json format"}:e.json()})).then((t=>{s.result=t,e(s)})).catch((e=>{"AbortError"===e.name?(clearTimeout(a),console.log("abort",this.params.action_name)):console.error("Fetch error:",e)}))}))}}t.A=p},2878:function(e,t,a){var s=a(8700),n=a(6343),r=a(3175),o=a(3177);class i{get_group_form(){let e={action_name:"getgroupform",method:"GET",url:(0,s.A)().endpoint_url()+"online/getgroupform/"+(0,s.A)().product_group_id()+"/?global=2&json=1"};e.url+=n.A.add_token_as_parameter(),e.url+=(0,o.A)().agent_code_param();let t=new r.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}validate_group_form(){let e={action_name:"validategroupform",method:"POST",body:n.A.serialize_user_input(),url:(0,s.A)().endpoint_url()+"online/validategroupform/"+(0,s.A)().product_group_id()+"/?global=2&without_form=1"};e.url+=n.A.add_token_as_parameter(),e.url+=(0,o.A)().add_filtered_param();let t=new r.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}}t.A=new i},9452:function(e,t,a){var s=a(8700),n=a(6343),r=a(3175);class o{session_info(){let e={action_name:"getsessioninfo",method:"GET",url:(0,s.A)().endpoint_url()+"online/getsessioninfo/?"+n.A.add_token_as_parameter()},t=new r.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}get_data(){let e={action_name:"getdata",method:"GET",url:(0,s.A)().endpoint_url()+"online/getdata/?"+n.A.add_token_as_parameter()},t=new r.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}set_data(e){let t={action_name:"setdata",method:"POST",url:(0,s.A)().endpoint_url()+"online/setdata/?"+n.A.serialize_object(e)+n.A.add_token_as_parameter()},a=new r.A;return a.prepare_params(t).handle_response().catch((e=>{throw e}))}}t.A=new o},7458:function(e,t,a){a.r(t),a.d(t,{default:function(){return l}});var s=a(641);const n={class:"text-center mt-5"};function r(e,t,a,r,o,i){const c=(0,s.g2)("Bouncer_loading");return(0,s.uX)(),(0,s.CE)("section",n,[t[0]||(t[0]=(0,s.Lk)("p",null,"Kontrolujem stav ponuky.",-1)),(0,s.bF)(c,{size:"small"})])}var o=a(8700),i=a(2878),c=a(9452),p=a(55),u={props:{},components:{Bouncer_loading:p.A},emits:[],data(){return{}},created(){Promise.resolve().then((()=>c.A.session_info())).then((e=>200!==e.status?Promise.reject("session_info api failed"):e.result.state>=100?((0,o.A)().change_step(5),Promise.reject("session state >= 100")):void 0)).then((()=>i.A.validate_group_form())).then((e=>{200===e.status&&(!0===e.result.validform?(0,o.A)().change_step(2):(0,o.A)().change_step(1))})).catch((e=>{console.log(e)}))},methods:{},computed:{},watch:{}},h=a(6262);const _=(0,h.A)(u,[["render",r]]);var l=_},55:function(e,t,a){a.d(t,{A:function(){return u}});var s=a(641),n=a(33);const r={class:"spinner"};function o(e,t,a,o,i,c){return(0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",{class:(0,n.C4)(["bounce1",a.size])},null,2),(0,s.Lk)("div",{class:(0,n.C4)(["bounce2",a.size])},null,2),(0,s.Lk)("div",{class:(0,n.C4)(["bounce3",a.size])},null,2)])}var i={props:{size:String},components:{},data(){return{}},created(){},methods:{},computed:{}},c=a(6262);const p=(0,c.A)(i,[["render",o]]);var u=p}}]);