"use strict";(self["webpackChunkosmapp_webpack_3x25x"]=self["webpackChunkosmapp_webpack_3x25x"]||[]).push([[890],{55:function(e,t,a){a.d(t,{A:function(){return p}});var o=a(641),s=a(33);const n={class:"spinner"};function r(e,t,a,r,i,c){return(0,o.uX)(),(0,o.CE)("div",n,[(0,o.Lk)("div",{class:(0,s.C4)(["bounce1",a.size])},null,2),(0,o.Lk)("div",{class:(0,s.C4)(["bounce2",a.size])},null,2),(0,o.Lk)("div",{class:(0,s.C4)(["bounce3",a.size])},null,2)])}var i={props:{size:String},components:{},data(){return{}},created(){},methods:{},computed:{}},c=a(6262);const l=(0,c.A)(i,[["render",r]]);var p=l},2563:function(e,t,a){a.d(t,{A:function(){return _}});var o=a(641),s=a(33);const n={class:"modal-content","data-cy":"modal_content"},r={class:"modal-header"},i={class:"modal-body","data-cy":"modal_body"};function c(e,t,a,c,l,p){return(0,o.uX)(),(0,o.CE)("div",{onClick:t[1]||(t[1]=(...e)=>p.did_click_outside&&p.did_click_outside(...e)),class:(0,s.C4)(["vue_modal",a.modal_size]),"data-cy":"modal"},[(0,o.Lk)("div",n,[(0,o.Lk)("div",r,[a.icon?((0,o.uX)(),(0,o.CE)("span",{key:0,class:(0,s.C4)(["modal-icon",a.icon])},null,2)):(0,o.Q3)("",!0),(0,o.Lk)("h4",null,(0,s.v_)(a.title),1),a.close?((0,o.uX)(),(0,o.CE)("span",{key:1,onClick:t[0]||(t[0]=(...e)=>p.close_me&&p.close_me(...e)),class:"i_close"})):(0,o.Q3)("",!0)]),(0,o.Lk)("div",i,[(0,o.RG)(e.$slots,"default")])])],2)}var l=a(2873),p={props:{close:Boolean,title:String,modal_size:String,icon:{type:String}},components:{},emits:[],data(){return{}},created(){document.addEventListener("keyup",this.close_me)},beforeUnmount(){document.removeEventListener("keyup",this.close_me)},methods:{close_me(e){this.close&&("click"===e?.type||"keyup"===e?.type&&27===e?.keyCode)&&(0,l.A)().close_them_all()},did_click_outside(e){e.target.classList.contains("vue_modal")&&this.close_me(e)}},computed:{},watch:{}},d=a(6262);const u=(0,d.A)(p,[["render",c]]);var _=u},2878:function(e,t,a){var o=a(8700),s=a(6343),n=a(3175),r=a(3177);class i{get_group_form(){let e={action_name:"getgroupform",method:"GET",url:(0,o.A)().endpoint_url()+"online/getgroupform/"+(0,o.A)().product_group_id()+"/?global=2&json=1"};e.url+=s.A.add_token_as_parameter(),e.url+=(0,r.A)().agent_code_param();let t=new n.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}validate_group_form(){let e={action_name:"validategroupform",method:"POST",body:s.A.serialize_user_input(),url:(0,o.A)().endpoint_url()+"online/validategroupform/"+(0,o.A)().product_group_id()+"/?global=2&without_form=1"};e.url+=s.A.add_token_as_parameter(),e.url+=(0,r.A)().add_filtered_param();let t=new n.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}}t.A=new i},3175:function(e,t,a){var o=a(1114),s=a(8700),n=a(2873),r=a(5833),i=a(2754),c=a(3177),l=a(9885);class p{constructor(){(0,o.A)(this,"params",{}),(0,o.A)(this,"headers",{}),(0,o.A)(this,"auth_fails",0),(0,o.A)(this,"auth_max",6)}prepare_params(e){return this.params=e,void 0===this.params.timeout&&(this.params.timeout=29),this.headers={method:this.params.method,mode:"cors",cache:"no-cache",credentials:"omit",signal:(0,i.A)().get_abort_signal(),headers:{"x-user-scope":(0,s.A)().give_api_scope(),Authorization:(0,s.A)().give_bearer(),Accept:"application/json"}},"POST"===this.params.method&&this.params.body&&(this.headers.body=this.params.body),void 0===this.params.content_type?this.headers.headers["Content-Type"]="application/x-www-form-urlencoded":null!==this.params.content_type&&(this.headers.headers["Content-Type"]=this.params.content_type),this}async unauthorized(){let e=(0,s.A)().get_backend_type(),t=(0,s.A)().get_endpoint_type(),a=(0,c.A)().get_receiver(),o=await l.A.captcha_api(),n={php_wrapper:"/authorize_frontend/?endpoint="+t+"&receiver="+a+"&cache=no",np_wp:"/wp-content/themes/najpoistenie/api_php_requests/authorize_frontend.php",fp_symfony:"/osmapp/auth/?receiver="+a+"&cache=no",np_symfony:"/osmapp/auth/?captcha="+o+"&cache=no",wrapper_sf:"/osmapp/auth/?endpoint="+t+"&receiver="+a+"&cache=no"};if(n.hasOwnProperty(e)){let t=window.location.origin+n[e];return fetch(t).then(e=>e.json()).then(e=>!!e&&((0,s.A)().save_bearer(e),!0))}if("lukas_local"===e){let e="http://wrapper.local/authorize_frontend/?endpoint="+t+"&receiver="+a;return fetch(e).then(e=>e.json()).then(e=>((0,s.A)().save_bearer(e),!0))}return"vue"===e?(console.log("VUE does not have 401 auth service, fill access_token into env.js"),!1):"myport"===e?(0,s.A)().myport_access_token_promise().then(e=>!1!==e&&((0,s.A)().save_bearer(e),!0)):(console.log("backend_type "+e+" has no access to new authorization"),!1)}async switch_receiver(){let e=(0,s.A)().get_backend_type(),t=(0,s.A)().get_endpoint_type(),a=(0,c.A)().get_receiver(),o=await l.A.captcha_api(),n={lukas_local:"http://wrapper.local/authorize_frontend/?endpoint="+t+"&receiver="+a+"&cache=allow",wrapper_sf:window.location.origin+"/osmapp/auth/?endpoint="+t+"&receiver="+a+"&cache=allow",php_wrapper:window.location.origin+"/authorize_frontend/?endpoint="+t+"&receiver="+a+"&cache=allow",fp_symfony:window.location.origin+"/osmapp/auth/?receiver="+a+"&cache=allow",np_symfony:window.location.origin+"/osmapp/auth/?captcha="+o+"&cache=allow"};if("vue"===e)return!0;if(!n.hasOwnProperty(e))return console.log("backend_type "+e+" cant authorize itself"),!1;let r=n[e];return fetch(r).then(e=>e.json()).then(e=>!!e&&((0,s.A)().save_bearer(e),!0))}async handle_response(){let e=await this.call_the_api_request();if(200===e.status)return this.auth_fails=0,e;if(401===e.status){if(this.auth_fails++,this.auth_fails>this.auth_max)return console.log("Authorization reched maximum attempts. Try to refresh the app or report to admin."),{};let e=await this.unauthorized();return e?await this.prepare_params(this.params).handle_response():null}if(423===e.status&&-1===["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name))return(0,n.A)().open_it("Clearance"),e;if(503===e.status)return(0,s.A)().set_overseer_view(503),e;if(408===e.status)return console.log("408 in request "+this.params.action_name),-1===["calculate_step2","calculate_step4","confirm"].indexOf(this.params.action_name)&&(0,n.A)().open_it("Server_timeout"),e;if(500===e.status&&"calculate_step2"===this.params.action_name||422===e.status&&"confirm"===this.params.action_name||412===e.status&&"confirm"===this.params.action_name||422===e.status&&"getsessioninfo"===this.params.action_name||"ico-info"===this.params.action_name||["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name)>-1||422===e.status&&"session-remap"===this.params.action_name||422===e.status&&"id-scan/add-page"===this.params.action_name||422===e.status&&"id-scan/get-scan-groups"===this.params.action_name||422===e.status&&"identity-scan-check"===this.params.action_name||422===e.status&&"identity-scan"===this.params.action_name||(422===e.status||409===e.status)&&"signature-code-check"===this.params.action_name||(422===e.status||409===e.status)&&"signature-code-send"===this.params.action_name||500===e.status&&"id-scan/get-scan-groups"===this.params.action_name||425===e.status&&"id-scan/get-scan-groups"===this.params.action_name||425===e.status&&"id-scan/get-scan-group-documents"===this.params.action_name||422===e.status&&"payment-create"===this.params.action_name||422===e.status&&"offer-notify"===this.params.action_name)return e;{let t=(new Date).toLocaleString(),a=(0,s.A)().get_session_token(),o=(0,s.A)().current_step();return(0,r.A)().set_last_request(this.headers,this.params,t,a,o,e),(0,s.A)().set_overseer_view(404),(0,n.A)().close_them_all(),e}}call_the_api_request(){return new Promise((e,t)=>{let a=setTimeout(function(){return e({status:408,statusText:"Request Timeout"})},1e3*this.params.timeout),o={};fetch(this.params.url,this.headers).then(e=>{o=e;let t=e.headers.get("content-type");return-1===t.indexOf("json")?{response:"not in json format"}:e.json()}).then(t=>{o.result=t,e(o)}).catch(e=>{"AbortError"===e.name?(clearTimeout(a),console.log("abort",this.params.action_name)):console.error("Fetch error:",e)})})}}t.A=p},8222:function(e,t,a){var o=a(8700),s=a(6343),n=a(3175),r=a(3177);class i{get_user_form(){let e={action_name:"getform",method:"POST",body:null,url:(0,o.A)().endpoint_url()+"online/getform/"+(0,r.A)().get_selected_product().form_id+"/?json=1"};e.url+=s.A.add_token_as_parameter();let t=new n.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}validate_user_form(){let e={action_name:"validateform",method:"POST",body:s.A.serialize_user_input(),url:(0,o.A)().endpoint_url()+"online/validateform/"+(0,r.A)().get_selected_product().form_id+"/?without_form=1"};e.url+=s.A.add_token_as_parameter();let t=new n.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}}t.A=new i},9452:function(e,t,a){var o=a(8700),s=a(6343),n=a(3175);class r{session_info(){let e={action_name:"getsessioninfo",method:"GET",url:(0,o.A)().endpoint_url()+"online/getsessioninfo/?"+s.A.add_token_as_parameter()},t=new n.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}get_data(){let e={action_name:"getdata",method:"GET",url:(0,o.A)().endpoint_url()+"online/getdata/?"+s.A.add_token_as_parameter()},t=new n.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}set_data(e){let t={action_name:"setdata",method:"POST",url:(0,o.A)().endpoint_url()+"online/setdata/?"+s.A.serialize_object(e)+s.A.add_token_as_parameter()},a=new n.A;return a.prepare_params(t).handle_response().catch(e=>{throw e})}}t.A=new r},9890:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var o=a(641),s=a(33);const n={class:"text-center p-3"};function r(e,t,a,r,i,c){const l=(0,o.g2)("Bouncer_loading"),p=(0,o.g2)("Modal_body");return(0,o.uX)(),(0,o.Wv)(p,{close:!0,title:"Zotavenie session",class:"modal-error",icon:"i_error"},{default:(0,o.k6)(()=>[t[1]||(t[1]=(0,o.Lk)("p",null," Skontrolujeme aký bol posledný úspešný stav porovnania. ",-1)),(0,o.Lk)("div",n,[0===i.designated_location?((0,o.uX)(),(0,o.Wv)(l,{key:0,size:"large"})):((0,o.uX)(),(0,o.CE)("button",{key:1,onClick:t[0]||(t[0]=(...e)=>c.send_troops&&c.send_troops(...e)),class:"btn btn-outline-primary"}," Pokracovať v kroku "+(0,s.v_)(this.designated_location),1))])]),_:1,__:[1]})}var i=a(2563),c=a(9452),l=a(8700),p=a(2873),d=a(2878),u=a(8222),_=a(3177),h=a(55),m={props:{},components:{Modal_body:i.A,Bouncer_loading:h.A},emits:[],data(){return{designated_location:0}},created(){Promise.resolve().then(()=>(console.log("getsessioninfo"),c.A.session_info())).then(e=>{if(console.log("stav session je: "+e.result.state),e.result?.state>=100)return console.log("session je uz confirmuta, takze do step5"),this.designated_location=5,Promise.reject("resurrection done")}).then(()=>(console.log("validategroupform"),d.A.validate_group_form())).then(e=>{if(console.log("je form validny? "+e.result.validform),!1===e.result.validform)return console.log("neni. takze pojdes do step1"),this.designated_location=1,Promise.reject("resurrection done")}).then(()=>(console.log("getdata"),c.A.get_data())).then(e=>{if(console.log("bol vybraty produkt id: "+e.result?.call_params?.product_id),(0,_.A)().extract_selected_product(e),null===(0,_.A)().get_selected_product().product_id)return console.log("takze nebol. pojdes step2."),this.designated_location=2,Promise.reject("resurrection done")}).then(()=>(console.log("validateform"),u.A.validate_user_form())).then(e=>{if(console.log("je formular validny? "+e.result.validform),!1===e.result.validform)return console.log("neni. takze sup do step3"),this.designated_location=3,Promise.reject("resurrection done")}).then(()=>(console.log("getsessioninfo"),c.A.session_info())).then(e=>{if(console.log("stav session je: "+e.result.state),e.result?.state<100)return console.log("este neni confirmuta, takze do step4"),this.designated_location=4,Promise.reject("resurrection done")}).then(()=>{console.log("uz je confirmuta, tak sup step5"),this.designated_location=5}).catch(e=>{console.log(e)})},methods:{send_troops(){(0,l.A)().change_step(this.designated_location),(0,p.A)().close_them_all()}},computed:{},watch:{}},f=a(6262);const g=(0,f.A)(m,[["render",r]]);var v=g}}]);