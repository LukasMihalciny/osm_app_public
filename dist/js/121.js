"use strict";(self["webpackChunkosmapp_webpack_3x25x"]=self["webpackChunkosmapp_webpack_3x25x"]||[]).push([[121],{1211:function(t,e,s){s.r(e),s.d(e,{default:function(){return bt}});var n=s(641),o=s(33);const r={class:"row"};function a(t,e,s,a,i,c){const u=(0,n.g2)("Info"),l=(0,n.g2)("Actions_loader"),_=(0,n.g2)("Internal_step");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.bF)(u),(0,n.Lk)("div",{class:(0,o.C4)([c.find_template]),"data-cy":"https://youtu.be/dQw4w9WgXcQ"},[(0,n.Lk)("div",r,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(c.step_actions,(t,e)=>((0,n.uX)(),(0,n.Wv)(l,{action:t,onRequested_step:c.next_step},null,8,["action","onRequested_step"]))),256)),i.display_internal?((0,n.uX)(),(0,n.Wv)(_,{key:0,error:i.error,onRepeat_next:c.next_step},null,8,["error","onRepeat_next"])):(0,n.Q3)("",!0)])],2)],64)}s(4114);var i=s(3952),c=s(2310);function u(t,e,s,r,a,i){const c=(0,n.g2)("Image_action"),u=(0,n.g2)("Navigation_action"),l=(0,n.g2)("Form_action"),_=(0,n.g2)("Html_action");return(0,n.uX)(),(0,n.CE)("div",{class:(0,o.C4)([i.size]),"data-cy":"https://youtu.be/dQw4w9WgXcQ"},["image"===i.type?((0,n.uX)(),(0,n.Wv)(c,{key:0,action:s.action},null,8,["action"])):"navigation"===i.type?((0,n.uX)(),(0,n.Wv)(u,{key:1,action:s.action,onRequested_step:i.requested_step},null,8,["action","onRequested_step"])):"getForm"===i.type?((0,n.uX)(),(0,n.Wv)(l,{key:2,action:s.action,onNext_step:i.next_step},null,8,["action","onNext_step"])):"getHtml"===i.type?((0,n.uX)(),(0,n.Wv)(_,{key:3,action:s.action},null,8,["action"])):(0,n.Q3)("",!0)],2)}const l={class:"row"},_={class:"col-6 offset-3"},p=["src"];function d(t,e,s,o,r,a){return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",_,[(0,n.Lk)("img",{class:"img",src:a.give_img},null,8,p)])])}var m={props:{action:Object},components:{},data(){return{}},mounted(){},methods:{},computed:{give_img(){return this.action.functionParams.url}}},h=s(6262);const v=(0,h.A)(m,[["render",d],["__scopeId","data-v-7248ce3a"]]);var f=v;const k={class:"row mt-4 mb-2 justify-content-center align-items-center"},b={class:"col text-center"},g=["onClick"];function w(t,e,s,r,a,i){return(0,n.uX)(),(0,n.CE)("div",k,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.action.functionParams,(t,e)=>((0,n.uX)(),(0,n.CE)("div",b,[(0,n.Lk)("button",{class:(0,o.C4)(["btn btn-m btn-primary",t.arrow?"btn-"+t.arrow:""]),onClick:e=>i.change_step_or_return_to_myport(t.step)},(0,o.v_)(t.label),11,g)]))),256))])}var y={props:{action:Object},components:{},data(){return{}},mounted(){},emits:["requested_step"],methods:{change_step_or_return_to_myport(t){0==t&&(console.log("osmapp history back to myport"),history.back()),this.$emit("requested_step",t)}},computed:{}};const A=(0,h.A)(y,[["render",w]]);var x=A;const C={class:"row mt-4 mb-2 justify-content-center align-items-center","data-cy":"https://youtu.be/dQw4w9WgXcQ"},L={class:"col text-center"},X={class:"col text-center"},q={class:"row"},j={class:"col-12"},P={class:"row mt-4 mb-2 justify-content-center align-items-center","data-cy":"https://youtu.be/dQw4w9WgXcQ"},E={class:"col text-center"},I={class:"col text-center"};function Q(t,e,s,o,r,a){const i=(0,n.g2)("Tabs");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("div",C,[(0,n.Lk)("div",L,[a.show_back_button?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"btn btn-m btn-primary btn-left",onClick:e[0]||(e[0]=t=>a.prev())}," Naspäť ")):(0,n.Q3)("",!0)]),(0,n.Lk)("div",X,[(0,n.Lk)("button",{class:"btn btn-m btn-primary btn-right",onClick:e[1]||(e[1]=t=>a.next())}," Pokračovať ")])]),(0,n.Lk)("div",q,[(0,n.Lk)("div",j,[(0,n.bF)(i)])]),(0,n.Lk)("div",P,[(0,n.Lk)("div",E,[a.show_back_button?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"btn btn-m btn-primary btn-left",onClick:e[2]||(e[2]=t=>a.prev())}," Naspäť ")):(0,n.Q3)("",!0)]),(0,n.Lk)("div",I,[(0,n.Lk)("button",{class:"btn btn-m btn-primary btn-right",onClick:e[3]||(e[3]=t=>a.next())}," Pokračovať ")])])],64)}var F=s(3175),W=s(6343),T=s(8700);class z{osmapi_get_form(t){let e={action_name:"get-form",method:"GET",url:(0,T.A)().endpoint_url()+"osmapi/get-form/"+(0,T.A)().get_session_token()};var s=[];s.push("source="+t.functionParams.source),s.push("source-id="+t.functionParams["source-id"]),s.push("action-id="+t.id),s.push("json=1"),s.length>0&&(e.url+="/?"+s.join("&"));let n=new F.A;return n.prepare_params(e).handle_response().catch(t=>{throw t})}osmapi_validate_form(t){let e={action_name:"validate-form",method:"POST",url:(0,T.A)().endpoint_url()+"osmapi/validate-form/"+(0,T.A)().get_session_token(),body:W.A.objectify_user_input(),content_type:"application/json"};var s=[];s.push("source="+t.functionParams.source),s.push("source-id="+t.functionParams["source-id"]),s.push("action-id="+t.id),s.push("json=1"),s.push("without_form=1"),s.length>0&&(e.url+="/?"+s.join("&"));let n=new F.A;return n.prepare_params(e).handle_response().catch(t=>{throw t})}}var N=new z,O=s(8565),R=s(6460),D=s(9614),H=s(3177),K=s(7618),$={props:{action:Object},components:{Tabs:O.A},data(){return{tab_current:0,tab_last:0}},mounted(){Promise.resolve().then(()=>c.A.flow_status()).then(t=>{200===t.status&&(0,H.A)().store_call_params(t.result.data?.sessionData)}).then(()=>N.osmapi_get_form(this.action)).then(t=>{if(200===t.status){var e=t.result?.data?.resultData?.form;(0,R.A)().set_form(e),(0,H.A)().insert_form_values(e),(0,D.A)().set_tab_keys(e)}})},methods:{prev(){},next(){this.validate_form()},validate_form(){Promise.resolve().then(()=>K.A.check_flow_scan_promise()).then(()=>N.osmapi_validate_form(this.action)).then(t=>{(0,R.A)().set_errors(t.result?.data?.resultData?.form_validation_error_elements),!1!==t.result.data?.resultData?.validform?((0,R.A)().clear_form(),this.$emit("next_step")):W.A.adjust_view(!0)}).catch(t=>{console.log(t)})}},computed:{show_back_button(){return this.tab_last>1&&this.tab_current>1},requested_direction(){return(0,D.A)().get_requested_direction()}},watch:{requested_direction(){null!==this.requested_direction&&("backward"===this.requested_direction?((0,D.A)().reset_requested_direction(),this.prev()):"forward"===this.requested_direction&&((0,D.A)().reset_requested_direction(),this.next()))}}};const B=(0,h.A)($,[["render",Q]]);var S=B;const G={class:"row my-3"},M={class:"col-12"},Z=["innerHTML"];function J(t,e,s,o,r,a){return(0,n.uX)(),(0,n.CE)("div",G,[(0,n.Lk)("div",M,[(0,n.Lk)("div",{class:"prop_wording",innerHTML:a.print_html},null,8,Z)])])}class U{osmapi_get_flow_html(t){let e={action_name:"get-html",method:"GET",url:(0,T.A)().endpoint_url()+"osmapi/get-html/"+(0,T.A)().get_session_token()};var s=[];s.push("template="+t.functionParams.template),s.length>0&&(e.url+="/?"+s.join("&"));var n=new F.A;return n.prepare_params(e).handle_response().catch(t=>{throw t})}}var V=new U,Y={props:{action:Object},components:{},data(){return{html:""}},mounted(){V.osmapi_get_flow_html(this.action).then(t=>{200===t.status&&(this.html=t.result.data.resultData.html)})},methods:{},computed:{print_html(){return this.html}}};const tt=(0,h.A)(Y,[["render",J]]);var et=tt,st={props:{action:Object},components:{Image_action:f,Navigation_action:x,Form_action:S,Html_action:et},emits:["requested_step","next_step"],data(){return{}},created(){},methods:{requested_step(t){this.$emit("requested_step",t)},next_step(){this.$emit("requested_step")}},computed:{type(){return this.action.function},size(){return"full"===this.action.functionPosition.size?"col-12":"half"===this.action.functionPosition.size?"col-12 col-lg-6":"col-12"},cypres(){return"action_"+this.action.function+"_order_"+this.action.functionPosition.order}},watch:{}};const nt=(0,h.A)(st,[["render",u]]);var ot=nt;const rt={key:0,class:"calc_title_area mt-5"},at={class:"row"},it={class:"col-4"},ct={class:"col-4"},ut={class:"col-4"},lt={key:1,class:"calc_title_area mt-5"};function _t(t,e,s,r,a,i){const c=(0,n.g2)("Bouncer_loading");return s.error?((0,n.uX)(),(0,n.CE)("div",rt,[e[1]||(e[1]=(0,n.Lk)("h2",{class:"text-primary"},"Interný krok zlyhal",-1)),e[2]||(e[2]=(0,n.Lk)("p",{class:"mb-5 text-center"},"Spracovanie zlyhalo. Skúste ho prosím manuálne zopakovať.",-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.internal_actions,(t,e)=>((0,n.uX)(),(0,n.CE)("div",at,[(0,n.Lk)("div",it,(0,o.v_)(t.name),1),(0,n.Lk)("div",ct,(0,o.v_)(t.token),1),(0,n.Lk)("div",ut,(0,o.v_)(t.error),1)]))),256)),(0,n.Lk)("button",{onClick:e[0]||(e[0]=e=>t.$emit("repeat_next")),class:"btn btn-primary mt-5"},"Zopakovať")])):((0,n.uX)(),(0,n.CE)("div",lt,[e[3]||(e[3]=(0,n.Lk)("h2",{class:"text-primary"},"Prebieha spracovanie interného kroku",-1)),e[4]||(e[4]=(0,n.Lk)("p",{class:"mb-3 text-center"},"Chvíľu prosím počkajte kým spracujeme všetky dôležité časti.",-1)),(0,n.bF)(c,{class:"mt-3"})]))}var pt=s(55),dt=s(5143),mt={props:{error:Boolean},components:{Bouncer_loading:pt.A},emits:["repeat_next"],data(){return{}},created(){},methods:{},computed:{internal_actions(){var t=(0,dt.A)().get_workflow_actions();let e={};for(let s in t)e[s]={name:t[s].function,error:t[s].error,token:t[s].functionParams.token};return e}},watch:{}};const ht=(0,h.A)(mt,[["render",_t]]);var vt=ht,ft={props:{},components:{Info:i.A,Actions_loader:ot,Internal_step:vt},emits:[],data(){return{status_repeat_frequency:3e3,status_repeats_count:0,status_repeats_limit:10,display_internal:!1,error:!1}},created(){this.init_session()},methods:{init_session(){(0,T.A)().is_fresh_session()?c.A.flow_init_session().then(t=>{200===t.status&&this.what_to_do_next()}):this.status()},next_step(t=void 0){this.status_repeats_count=0,this.error=!1,c.A.flow_next_step(t).then(t=>{200===t.status&&this.what_to_do_next()})},status(){c.A.flow_status().then(t=>{200===t.status&&this.what_to_do_next()})},what_to_do_next(){this.display_internal=!1;var t=(0,dt.A)().get_workflow_step_state(),e=(0,dt.A)().get_workflow_internal(),s=(0,dt.A)().get_workflow_finished();if(!0!==s)if("success"===t)this.next_step();else if(!0===e){if(this.display_internal=!0,this.status_repeats_count>this.status_repeats_limit)return console.log("reached status repeat limit, stopping requests"),void(this.error=!0);this.status_repeats_count++,setTimeout(function(){this.status()}.bind(this),this.status_repeat_frequency)}}},computed:{step_actions(){var t,e=(0,dt.A)().get_workflow_actions(),s=[],n=e.length;for(t=0;t<n;t++)"template"!==e[t].function&&s.push(e[t]);return s},find_template(){var t,e=(0,dt.A)().get_workflow_actions(),s=e.length;for(t=0;t<s;t++)if("template"===e[t].function)return e[t].functionParams.type;return null}},watch:{}};const kt=(0,h.A)(ft,[["render",a],["__scopeId","data-v-97da0eb4"]]);var bt=kt}}]);