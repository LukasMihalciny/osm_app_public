"use strict";(self["webpackChunkosmapp_webpack_3x25x"]=self["webpackChunkosmapp_webpack_3x25x"]||[]).push([[421],{55:function(e,t,n){n.d(t,{A:function(){return c}});var r=n(641),s=n(33);const o={class:"spinner"};function a(e,t,n,a,i,_){return(0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("div",{class:(0,s.C4)(["bounce1",n.size])},null,2),(0,r.Lk)("div",{class:(0,s.C4)(["bounce2",n.size])},null,2),(0,r.Lk)("div",{class:(0,s.C4)(["bounce3",n.size])},null,2)])}var i={props:{size:String},components:{},data(){return{}},created(){},methods:{},computed:{}},_=n(6262);const l=(0,_.A)(i,[["render",a]]);var c=l},3886:function(e,t,n){var r=n(8700),s=n(6343),o=n(3175);class a{session_documents(e){let t={action_name:"getsessiondocuments",method:"GET",url:(0,r.A)().endpoint_url()+"online/getsessiondocuments/?"+s.A.add_token_as_parameter()};e&&(t.url+="&user_uploaded=true");let n=new o.A;return n.prepare_params(t).handle_response().catch(e=>{throw e})}get_session_document(e){let t={action_name:"getsessiondocument",method:"GET",url:(0,r.A)().endpoint_url()+"online/getsessiondocument/"+e+"/?"+s.A.add_token_as_parameter()},n=new o.A;return n.prepare_params(t).handle_response().catch(e=>{throw e})}get_session_document_preview(e,t){let n={action_name:"getsessiondocument",method:"GET",url:(0,r.A)().endpoint_url()+"online/getsessiondocument/"+e+"/?"+s.A.add_token_as_parameter()};n.url+="&filters=thumbnail&thumbnail_mode=outbound&thumbnail_width="+t+"&thumbnail_height="+t;let a=new o.A;return a.prepare_params(n).handle_response().catch(e=>{throw e})}upload_session_document(e){let t={action_name:"createsessiondocument",method:"POST",body:e,content_type:null,url:(0,r.A)().endpoint_url()+"online/createsessiondocument/?"+s.A.add_token_as_parameter()},n=new o.A;return n.prepare_params(t).handle_response().catch(e=>{throw e})}delete_session_document(e){let t={action_name:"delete-uploaded-session-documents",method:"DELETE",url:(0,r.A)().endpoint_url()+"online/delete-uploaded-session-documents/?id="+e+s.A.add_token_as_parameter()},n=new o.A;return n.prepare_params(t).handle_response().catch(e=>{throw e})}}t.A=new a},4326:function(e,t,n){var r=n(8700),s=n(6343),o=n(3175),a=n(3177);class i{get_calculate(e,t,n){let a={action_name:"calculate_step2",method:"POST",url:(0,r.A)().endpoint_url()+"online/calculate/?id="+e+"&json=1&period="+n+s.A.add_token_as_parameter(),body:t},i=new o.A;return i.prepare_params(a).handle_response().then(t=>408===t.status?(console.log("#"+e+" has 408, going for results request"),this.repeat_results()):t).catch(e=>{throw e})}check_calculate(){let e={action_name:"calculate_step4",method:"POST",url:(0,r.A)().endpoint_url()+"online/calculate/?"+s.A.add_token_as_parameter(),body:null};e.url+="&id="+(0,a.A)().get_selected_product().product_id+"&period="+(0,a.A)().get_selected_product().period;let t=new o.A;return t.prepare_params(e).handle_response().then(async e=>408===e.status?(console.log("calculate has 408 timeout, wait 1 minute and run results api"),await s.A.sleep(60),this.repeat_results()):e).catch(e=>{throw e})}repeat_results(){let e={action_name:"results",method:"GET",url:(0,r.A)().endpoint_url()+"online/results/?"+s.A.add_token_as_parameter()},t=new o.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}}t.A=new i},7654:function(e,t,n){var r=n(8700),s=n(6343),o=n(3175),a=n(5833),i=n(6460);class _{confirm_session(e){let t="";e&&(t=(0,i.A)().get_confirm_chbs(),t=s.A.serialize_object(t));let n={action_name:"confirm",method:"GET",url:(0,r.A)().endpoint_url()+"online/confirm/?"+t+s.A.add_token_as_parameter()},a=new o.A;return a.prepare_params(n).handle_response().then(e=>408===e.status||412===e.status?this.repeat_getsessioninfo(0):e).catch(e=>{throw e})}repeat_confirm(){let e={action_name:"confirm",method:"GET",url:(0,r.A)().endpoint_url()+"online/confirm/?"+s.A.add_token_as_parameter()},t=new o.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}async repeat_getsessioninfo(e){e++;let t=10,n=10;console.log("wait "+n+" seconds then try getsessioninfo, iteration: "+e+" (max "+t+")"),await s.A.sleep(n);let i={action_name:"getsessioninfo",method:"GET",url:(0,r.A)().endpoint_url()+"online/getsessioninfo/?"+s.A.add_token_as_parameter()},_=new o.A;return _.prepare_params(i).handle_response().then(n=>{if(100===n.result?.state)return n;if(e>=t){let e=(new Date).toLocaleString(),t=(0,r.A)().get_session_token(),s=(0,r.A)().current_step();return(0,a.A)().set_last_request({},i,e,t,s,n),(0,r.A)().change_step(404),{status:408,action_name:"getsessioninfo"}}return this.repeat_getsessioninfo(e)}).catch(e=>{throw e})}}t.A=new _},8020:function(e,t,n){n.r(t),n.d(t,{default:function(){return S}});var r=n(641),s=n(3751),o=n(33);const a={"data-cy":"calc_proposal"},i=["innerHTML"],_=["innerHTML"],l={class:"text-center pt-2 pb-5"},c={key:0,class:"prop_confirm mb-4"};function u(e,t,n,u,d,p){const m=(0,r.g2)("Title"),h=(0,r.g2)("Documents_prepare"),g=(0,r.g2)("Bouncer_loading"),A=(0,r.g2)("Confirm_form"),f=(0,r.g2)("Singnature_form");return(0,r.uX)(),(0,r.CE)("section",a,[(0,r.bF)(m,{title:"Takmer hotovo!"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",{innerHTML:d.html.view_header_text},null,8,i)]),_:1}),(0,r.Lk)("div",{innerHTML:d.html.contract_html,class:"prop_wording","data-cy":"proposal_template"},null,8,_),(0,r.bF)(h,{start_doc_requests:d.start_doc_requests,onAll_docs_finished:p.all_docs_finished,step_html:4},null,8,["start_doc_requests","onAll_docs_finished"]),(0,r.bo)((0,r.Lk)("div",l,[t[0]||(t[0]=(0,r.Lk)("h3",null,"Načítavame dokumenty",-1)),(0,r.bF)(g)],512),[[s.aG,!d.doc_requests_are_done]]),d.warning?(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",c,[t[1]||(t[1]=(0,r.Lk)("h5",{class:"text-warning"},"Upozornenie",-1)),(0,r.Lk)("p",null,(0,o.v_)(d.warning),1)],512)),[[s.aG,d.doc_requests_are_done]]):(0,r.Q3)("",!0),t[2]||(t[2]=(0,r.Lk)("span",{class:"proposal_scroll_anchor"},null,-1)),0===d.signature_required&&d.doc_requests_are_done?((0,r.uX)(),(0,r.Wv)(A,{key:1,confirm_running:d.confirm_running,onRun_confirm:p.run_confirm},null,8,["confirm_running","onRun_confirm"])):1===d.signature_required&&d.doc_requests_are_done?((0,r.uX)(),(0,r.Wv)(f,{key:2,confirm_running:d.confirm_running,onRun_confirm:p.run_confirm},null,8,["confirm_running","onRun_confirm"])):(0,r.Q3)("",!0)])}var d=n(9452),p=n(4326),m=n(8856),h=n(55),g=n(2873),A=n(3177),f=n(4001),w=n(9713);const k={class:"prop_confirm","data-cy":"acceptance_form"};function v(e,t,n,s,o,a){const i=(0,r.g2)("Confirm_checkboxes"),_=(0,r.g2)("Confirm_buttons");return(0,r.uX)(),(0,r.CE)("div",k,[t[0]||(t[0]=(0,r.Lk)("h3",{class:"text-primary"}," Záverečné potvrdenie ",-1)),(0,r.bF)(i,{mode:"classic",invalid_checkboxes:o.invalid_checkboxes},null,8,["invalid_checkboxes"]),(0,r.bF)(_,{mode:"classic",allow_back:!n.confirm_running,loading:n.confirm_running,onMain_button_press:a.main_button_press},null,8,["allow_back","loading","onMain_button_press"])])}var b=n(424),q=n(1391),x=n(6460),y={props:{confirm_running:Boolean},components:{Confirm_checkboxes:b.A,Confirm_buttons:q.A},emits:["run_confirm"],data(){return{invalid_checkboxes:!1}},created(){},methods:{main_button_press(){this.invalid_checkboxes=(0,x.A)().are_checkboxes_invalid(),this.invalid_checkboxes||this.$emit("run_confirm",!0)}},computed:{},watch:{}},T=n(6262);const j=(0,T.A)(y,[["render",v]]);var L=j,E=n(8700),C=n(7821),P=n(7654),G={props:{},components:{Documents_prepare:f.A,Bouncer_loading:h.A,Title:w.A,Confirm_form:L,Singnature_form:C.A},data(){return{debug:!1,start_doc_requests:!1,doc_requests_are_done:!1,confirm_running:!1,signature_required:0,html:{contract_html:"",view_header_text:""},warning:void 0}},created(){Promise.resolve().then(()=>d.A.session_info()).then(e=>{if(e.result?.state>=100)return(0,E.A)().change_step(5),Promise.reject("session already confirmed");1===e.result.read_only&&(0,E.A)().set_read_only(),this.signature_required=e.result?.signature_required,console.log("signature_required",e.result?.signature_required)}).then(()=>d.A.get_data()).then(e=>200!==e.status?Promise.reject("get_data api failed"):((0,A.A)().extract_selected_product(e),(0,A.A)().store_call_params(e.result?.call_params),this.debug?(this.doc_requests_are_done=!0,Promise.reject("debug prevent calculate")):p.A.check_calculate())).then(e=>{let t=(0,A.A)().get_selected_product().product_id;return this.warning=e.result[t]?.result?.result?.warning?.result,!1===e.result.validform?((0,g.A)().store_modal_data({type:"calculate_step4_validate_form_didnt_pass",errors:e.result?.form_validation_error_elements,is_client_role:1===this.signature_required&&"poistnik"===this.role}),(0,g.A)().open_it("Ordinary_error_modal"),Promise.reject("prevent documents, validform false")):void 0!==e.result[t]?.result?.errors?((0,g.A)().store_modal_data({type:"calculate_step4_webservice_didnt_accept_form",errors:e.result[t]?.result?.errors,is_client_role:1===this.signature_required&&"poistnik"===this.role}),(0,g.A)().open_it("Ordinary_error_modal"),Promise.reject("prevent documents, webservice rejected")):200!==e.status?((0,g.A)().store_modal_data({type:"calculate_step4_unexpected_response_code",errors:null,is_client_role:1===this.signature_required&&"poistnik"===this.role}),(0,g.A)().open_it("Ordinary_error_modal"),Promise.reject("prevent documents, response code")):void 0}).then(()=>{m.A.get_it(!1).then(e=>{this.html.contract_html=e.result?.html}),m.A.get_json_api("view_header_text").then(e=>{0===this.signature_required?this.html.view_header_text=e.result?.json?.both:"poistnik"===this.role?this.html.view_header_text=e.result?.json?.client:this.html.view_header_text=e.result?.json?.agent}),this.start_doc_requests=!0}).catch(e=>{console.log(e)})},methods:{all_docs_finished(){this.doc_requests_are_done=!0},run_confirm(e){this.confirm_running=!0,P.A.confirm_session(e).then(e=>{if(this.confirm_running=!1,200===e.status&&("success"===e.result?.response||100===e.result?.state))return(0,x.A)().$reset(),void(0,E.A)().change_step(5);(0,g.A)().store_modal_data({type:"confirm_step4_didnt_succeed",errors:e.result?.data?.errors||{message:e.result?.message},is_client_role:1===this.signature_required&&"poistnik"===this.role}),(0,g.A)().open_it("Ordinary_error_modal")})}},computed:{role(){return(0,E.A)().get_signature_role()}},watch:{}};const O=(0,T.A)(G,[["render",u]]);var S=O},8856:function(e,t,n){var r=n(8700),s=n(6343),o=n(3175),a=n(3177);class i{get_it(e){!1===e&&(e=(0,a.A)().get_selected_product().next_contract);let t={action_name:"gethtml",method:"POST",url:(0,r.A)().endpoint_url()+"online/gethtml/?id="+e+s.A.add_token_as_parameter()},n=new o.A;return n.prepare_params(t).handle_response().catch(e=>{throw e})}get_json_api(e){let t={action_name:"getjson",method:"POST",url:(0,r.A)().endpoint_url()+"online/getjson/?id="+e+s.A.add_token_as_parameter()},n=new o.A;return n.prepare_params(t).handle_response().catch(e=>{throw e})}}t.A=new i},9452:function(e,t,n){var r=n(8700),s=n(6343),o=n(3175);class a{session_info(){let e={action_name:"getsessioninfo",method:"GET",url:(0,r.A)().endpoint_url()+"online/getsessioninfo/?"+s.A.add_token_as_parameter()},t=new o.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}get_data(){let e={action_name:"getdata",method:"GET",url:(0,r.A)().endpoint_url()+"online/getdata/?"+s.A.add_token_as_parameter()},t=new o.A;return t.prepare_params(e).handle_response().catch(e=>{throw e})}set_data(e){let t={action_name:"setdata",method:"POST",url:(0,r.A)().endpoint_url()+"online/setdata/?"+s.A.serialize_object(e)+s.A.add_token_as_parameter()},n=new o.A;return n.prepare_params(t).handle_response().catch(e=>{throw e})}}t.A=new a}}]);