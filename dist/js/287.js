"use strict";(self["webpackChunkosmapp_webpack_3xx"]=self["webpackChunkosmapp_webpack_3xx"]||[]).push([[287],{6884:function(e,t,a){var i=a(8700),n=a(6343),s=a(3175);class o{identity_scan(e,t){let a={action_name:"identity-scan",method:"GET",url:(0,i.A)().endpoint_url()+"online/identity-scan/?"+n.A.add_token_as_parameter()};a.url+="&serviceToken=veriface&scanGroupName="+e+"&identType="+t;let o=new s.A;return o.prepare_params(a).handle_response().catch((e=>{throw e}))}identity_check(e){let t={action_name:"identity-scan-check",method:"GET",url:(0,i.A)().endpoint_url()+"online/identity-scan-check/?"+n.A.add_token_as_parameter()};t.url+="&serviceToken=veriface&scanGroupName="+e;let a=new s.A;return a.prepare_params(t).handle_response().catch((e=>{throw e}))}identity_refresh(){let e={action_name:"id-scan/get-scan-groups",method:"GET",url:(0,i.A)().endpoint_url()+"api/online/id-scan/get-scan-groups/?"+n.A.add_token_as_parameter()},t=new s.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}identity_flow_scan(e,t,a){let n={action_name:"identity-scan",method:"GET",url:(0,i.A)().endpoint_url()+"osmapi/identity-scan/"+(0,i.A)().get_session_token()+"/?"};n.url+="serviceToken=veriface&identToken="+e+"&identType="+t+"&action-id="+a;let o=new s.A;return o.prepare_params(n).handle_response().catch((e=>{throw e}))}identity_flow_check(e,t){let a={action_name:"identity-scan-check",method:"GET",url:(0,i.A)().endpoint_url()+"osmapi/identity-scan-check/"+(0,i.A)().get_session_token()+"/?"};a.url+="serviceToken=veriface&identToken="+e+"&action-id="+t;let n=new s.A;return n.prepare_params(a).handle_response().catch((e=>{throw e}))}identity_flow_refresh(){let e={action_name:"identity-scan-check",method:"GET",url:(0,i.A)().endpoint_url()+"osmapi/identity-scan-check/"+(0,i.A)().get_session_token()+"/?"};e.url+="serviceToken=veriface";let t=new s.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}}t.A=new o},4287:function(e,t,a){a.r(t),a.d(t,{default:function(){return G}});var i=a(641),n=a(33);const s={class:"row facial_scan"},o={key:0,class:"col-12"},r={class:"col-12 text-center my-3"},c={class:"col-12 mb-3"};function d(e,t,a,d,l,_){const h=(0,i.g2)("Veriface_iframe"),f=(0,i.g2)("Bouncer_loading"),u=(0,i.g2)("Scan_feedback"),p=(0,i.g2)("Modal_body");return(0,i.uX)(),(0,i.Wv)(p,{close:l.allow_closing,title:"op"===_.scan_type?"Naskenovanie dokladov":"Tvárová biometria",class:(0,n.C4)("op"===_.scan_type?"modal-credentials_scan":"modal-faceauth"),modal_size:"medium"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",s,[l.load_iframe?((0,i.uX)(),(0,i.CE)("div",o,[(0,i.bF)(h,{veriface_link:l.veriface_link,onVeriface_closing:_.veriface_closing},null,8,["veriface_link","onVeriface_closing"])])):(0,i.Q3)("",!0),(0,i.Lk)("div",r,[l.loading?((0,i.uX)(),(0,i.Wv)(f,{key:0})):(0,i.Q3)("",!0)]),(0,i.Lk)("div",c,[(0,i.bF)(u,{feedback:l.feedback},null,8,["feedback"])])])])),_:1},8,["close","title","class"])}a(4114);var l=a(4883),_=a(2873),h=a(55),f=a(6884),u=a(6460),p=a(3177),m=a(9614),k=a(7406),v=a(8700),g=a(5143);const y=["src"];function b(e,t,a,s,o,r){return(0,i.uX)(),(0,i.CE)("iframe",{src:a.veriface_link+"&embedded=true",allow:"camera;microphone",scrolling:"no",style:(0,n.Tr)([{width:"100%",transition:"all .5s","min-height":"300px",overflow:"none"},{height:o.height+"px"}])},null,12,y)}var w={props:{veriface_link:String},components:{},emits:["veriface_closing"],data(){return{height:300}},created(){window.addEventListener("message",this.listen_to_veriface)},beforeUnmount(){window.removeEventListener("message",this.listen_to_veriface)},methods:{listen_to_veriface(e){"https://app.veriface.eu"===e.origin&&("height"===e.data.action?this.height=Math.round(e.data.value):"close"===e.data.action&&this.$emit("veriface_closing",e.data.result))}},computed:{},watch:{}},A=a(6262);const T=(0,A.A)(w,[["render",b]]);var E=T,S={props:{},components:{Modal_body:l.A,Bouncer_loading:h.A,Scan_feedback:k.A,Veriface_iframe:E},emits:[],data(){return{debug:!1,loading:!0,allow_closing:!0,veriface_link:"",feedback:[],load_iframe:!1,check_attempt:0,check_max:10,check_delay:1e4}},created(){this.debug&&(this.add_feedback("DEBUG ON."),this.add_feedback("scanGroupName: "+this.facial_input_token)),this.face_init()},methods:{face_init(){this.loading=!0,Promise.resolve().then((()=>this.common_api?f.A.identity_scan(this.facial_input_token,this.scan_type):f.A.identity_flow_scan(this.facial_input_token,this.scan_type,this.flow_action_id))).then((e=>{if(this.loading=!1,200!==e.status)return this.add_feedback("Aktivácia overovania zlyhala."),void this.add_feedback(JSON.stringify(e.result?.message));this.common_api?this.veriface_link=e.result?.data?.url:this.veriface_link=e.result?.data?.resultData?.data?.url,this.load_iframe=!0,this.allow_closing=!1}))},veriface_closing(e){if(console.log("veriface",e),"SUCCESS"===e||"internal_repeat"===e){if(0===this.check_attempt&&this.add_feedback("Kontrolujeme dokumenty."),this.load_iframe=!1,this.loading=!0,this.check_attempt++,this.check_attempt>this.check_max)return this.add_feedback("Dosiahnuté maximálne množstvo pokusov. Vyskúšajte znovu alebo kontaktujte technickú podporu."),void(this.loading=!1);Promise.resolve().then((()=>this.common_api?f.A.identity_check(this.facial_input_token):f.A.identity_flow_check(this.facial_input_token,this.flow_action_id))).then((e=>{if(200!==e.status)return this.add_feedback("Kontrola overovania zlyhala."),void this.add_feedback(JSON.stringify(e.result?.message));this.common_api?this.face_fill(e.result):this.face_fill(e.result?.data?.resultData)}))}else(0,_.A)().close_them_all()},face_fill(e){if(console.log(e?.["scan-status"],e?.["provider-info"]?.status,e?.["provider-info"]?.verificationEndUserStatus),"verified"!==e?.["scan-status"])return void setTimeout((()=>{this.veriface_closing("internal_repeat")}),this.check_delay);if(this.loading=!1,"object"!==typeof e?.data||Object.keys(e?.data).length<=0)return this.add_feedback("Dáta v nesprávnom formáte."),void this.add_feedback(JSON.stringify(e));this.add_feedback("Overovanie bolo úspešné. Ukladáme Vaše údaje."),(0,p.A)().set_form_value(this.facial_input_token,"1"),(0,u.A)().clear_one_error(this.facial_input_token);let t=this.facial_settings?.prefix||"",a=this.facial_settings?.suffix||"";(0,p.A)().set_multiple_form_values(e?.data,t,a),this.debug&&(this.add_feedback(JSON.stringify(e?.data)),this.add_feedback('PREFIX: "'+t+'"'),this.add_feedback('SUFFIX: "'+a+'"')),setTimeout((()=>{(0,_.A)().close_them_all(),(0,m.A)().set_requested_direction("forward")}),3e3)},add_feedback(e){this.feedback.push(e)}},computed:{facial_input_token(){return(0,_.A)().retrieve_modal_data().field_id},facial_settings(){return(0,_.A)().retrieve_modal_data().data_fill},scan_type(){return(0,_.A)().retrieve_modal_data().scan_type},flow_action_id(){if(this.common_api)return null;let e=(0,g.A)().get_workflow_actions();for(let t in e)if("identityScan"===e[t]?.function&&e[t]?.functionParams?.identToken===this.facial_input_token)return e[t].id;return null},common_api(){return"form_app"===(0,v.A)().get_run_mode()}},watch:{}};const x=(0,A.A)(S,[["render",d]]);var G=x}}]);