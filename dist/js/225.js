"use strict";(self["webpackChunkosmapp_webpack_3xx"]=self["webpackChunkosmapp_webpack_3xx"]||[]).push([[225],{3175:function(t,e,a){var s=a(1114),n=a(8700),o=a(2873),r=a(5833),i=a(2754),c=a(3177);class p{constructor(){(0,s.A)(this,"params",{}),(0,s.A)(this,"headers",{}),(0,s.A)(this,"auth_fails",0),(0,s.A)(this,"auth_max",6)}prepare_params(t){return this.params=t,void 0===this.params.timeout&&(this.params.timeout=29),this.headers={method:this.params.method,mode:"cors",cache:"no-cache",credentials:"omit",signal:(0,i.A)().get_abort_signal(),headers:{"x-user-scope":(0,n.A)().give_api_scope(),Authorization:(0,n.A)().give_bearer(),Accept:"application/json"}},"POST"===this.params.method&&this.params.body&&(this.headers.body=this.params.body),void 0===this.params.content_type?this.headers.headers["Content-Type"]="application/x-www-form-urlencoded":null!==this.params.content_type&&(this.headers.headers["Content-Type"]=this.params.content_type),this}async unauthorized(){let t=(0,n.A)().get_backend_type(),e=(0,n.A)().get_endpoint_type(),a=(0,c.A)().get_receiver(),s={php_wrapper:"/authorize_frontend/?endpoint="+e+"&receiver="+a,np_wp:"/wp-content/themes/najpoistenie/api_php_requests/authorize_frontend.php",fp_symfony:"/osmapp/auth/?receiver="+a,np_symfony:"/osmapp/auth/",wrapper_sf:"/osmapp/auth/?endpoint="+e+"&receiver="+a};if(s.hasOwnProperty(t)){let e=window.location.origin+s[t];return fetch(e).then((t=>t.json())).then((t=>!!t&&((0,n.A)().save_bearer(t),!0)))}if("lukas_local"===t){let t="http://wrapper.local/authorize_frontend/?endpoint="+e+"&receiver="+a;return fetch(t).then((t=>t.json())).then((t=>((0,n.A)().save_bearer(t),console.log("NEW BEARER:"),console.log(t),!0)))}return"vue"===t?(console.log("VUE does not have 401 auth service, fill access_token into env.js"),!1):"myport"===t?(0,n.A)().myport_access_token_promise().then((t=>!1!==t&&((0,n.A)().save_bearer(t),!0))):(console.log("backend_type "+t+" has no access to new authorization"),!1)}async handle_response(){let t=await this.call_the_api_request();if(200===t.status)return this.auth_fails=0,t;if(401===t.status){if(this.auth_fails++,this.auth_fails>this.auth_max)return console.log("Authorization reched maximum attempts. Try to refresh the app or report to admin."),{};let t=await this.unauthorized();return t?await this.prepare_params(this.params).handle_response():null}if(423===t.status&&-1===["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name))return(0,o.A)().open_it("Clearance"),t;if(503===t.status)return(0,n.A)().change_step(503),t;if(408===t.status)return console.log("408 in request "+this.params.action_name),-1===["calculate_step2","calculate_step4","confirm"].indexOf(this.params.action_name)&&(0,o.A)().open_it("Server_timeout"),t;if(500===t.status&&"calculate_step2"===this.params.action_name||422===t.status&&"confirm"===this.params.action_name||412===t.status&&"confirm"===this.params.action_name||422===t.status&&"getsessioninfo"===this.params.action_name||"ico-info"===this.params.action_name||["car-data-search","car-valuation-options","car-valuation-price"].indexOf(this.params.action_name)>-1||422===t.status&&"session-remap"===this.params.action_name||422===t.status&&"id-scan/add-page"===this.params.action_name||422===t.status&&"id-scan/get-scan-groups"===this.params.action_name||422===t.status&&"identity-scan-check"===this.params.action_name||422===t.status&&"identity-scan"===this.params.action_name||(422===t.status||409===t.status)&&"signature-code-check"===this.params.action_name||(422===t.status||409===t.status)&&"signature-code-send"===this.params.action_name||500===t.status&&"id-scan/get-scan-groups"===this.params.action_name||425===t.status&&"id-scan/get-scan-groups"===this.params.action_name||425===t.status&&"id-scan/get-scan-group-documents"===this.params.action_name||422===t.status&&"payment-create"===this.params.action_name||422===t.status&&"offer-notify"===this.params.action_name)return t;{let e=(new Date).toLocaleString(),a=(0,n.A)().get_session_token(),s=(0,n.A)().current_step();return(0,r.A)().set_last_request(this.headers,this.params,e,a,s,t),(0,n.A)().change_step(404),(0,o.A)().close_them_all(),t}}call_the_api_request(){return new Promise(((t,e)=>{let a=setTimeout((function(){return t({status:408,statusText:"Request Timeout"})}),1e3*this.params.timeout),s={};fetch(this.params.url,this.headers).then((t=>{s=t;let e=t.headers.get("content-type");return-1===e.indexOf("json")?{response:"not in json format"}:t.json()})).then((e=>{s.result=e,t(s)})).catch((t=>{"AbortError"===t.name?(clearTimeout(a),console.log("abort",this.params.action_name)):console.error("Fetch error:",t)}))}))}}e.A=p},8856:function(t,e,a){var s=a(8700),n=a(6343),o=a(3175),r=a(3177);class i{get_it(t){!1===t&&(t=(0,r.A)().get_selected_product().next_contract);let e={action_name:"gethtml",method:"POST",url:(0,s.A)().endpoint_url()+"online/gethtml/?id="+t+n.A.add_token_as_parameter()},a=new o.A;return a.prepare_params(e).handle_response().catch((t=>{throw t}))}get_json_api(t){let e={action_name:"getjson",method:"POST",url:(0,s.A)().endpoint_url()+"online/getjson/?id="+t+n.A.add_token_as_parameter()},a=new o.A;return a.prepare_params(e).handle_response().catch((t=>{throw t}))}}e.A=new i},6225:function(t,e,a){a.r(e),a.d(e,{default:function(){return u}});var s=a(641);const n=["innerHTML"];function o(t,e,a,o,r,i){const c=(0,s.g2)("Modal_body");return(0,s.uX)(),(0,s.Wv)(c,{close:!0,title:"",modal_size:"huge",class:"modal-text header-overlap"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",{innerHTML:r.html},null,8,n)])),_:1})}var r=a(2583),i=a(8856),c={props:{},components:{Modal_body:r.A},emits:[],data(){return{html:""}},created(){i.A.get_it("view_agent_suhlas").then((t=>{this.html=t.result?.html}))},methods:{},computed:{},watch:{}},p=a(6262);const h=(0,p.A)(c,[["render",o]]);var u=h},2583:function(t,e,a){a.d(e,{A:function(){return m}});var s=a(641),n=a(33);const o={class:"modal-content","data-cy":"modal_content"},r={class:"modal-header"},i={class:"modal-body","data-cy":"modal_body"};function c(t,e,a,c,p,h){return(0,s.uX)(),(0,s.CE)("div",{onClick:e[1]||(e[1]=(...t)=>h.did_click_outside&&h.did_click_outside(...t)),class:(0,n.C4)(["vue_modal",a.modal_size]),"data-cy":"modal"},[(0,s.Lk)("div",o,[(0,s.Lk)("div",r,[(0,s.Lk)("h4",null,(0,n.v_)(a.title),1),a.close?((0,s.uX)(),(0,s.CE)("span",{key:0,onClick:e[0]||(e[0]=(...t)=>h.close_me&&h.close_me(...t)),class:"i_close"})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",i,[(0,s.RG)(t.$slots,"default")])])],2)}var p=a(2873),h={props:{close:Boolean,title:String,modal_size:String},components:{},emits:[],data(){return{}},created(){document.addEventListener("keyup",this.close_me)},beforeUnmount(){document.removeEventListener("keyup",this.close_me)},methods:{close_me(t){this.close&&("click"===t?.type||"keyup"===t?.type&&27===t?.keyCode)&&(0,p.A)().close_them_all()},did_click_outside(t){t.target.classList.contains("vue_modal")&&this.close_me(t)}},computed:{},watch:{}},u=a(6262);const l=(0,u.A)(h,[["render",c]]);var m=l}}]);