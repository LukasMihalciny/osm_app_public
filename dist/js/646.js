"use strict";(self["webpackChunkosmapp_webpack_3xx"]=self["webpackChunkosmapp_webpack_3xx"]||[]).push([[646],{7618:function(e,t,n){n(4114);var s=n(6343),r=n(9452),a=n(6460),o=n(6884),i=n(2310);class _{check_scan_promise(){return new Promise(((e,t)=>{let n=this.displayed_scan_inputs_in_current_tab();0!==n.length?Promise.resolve().then((()=>o.A.identity_refresh())).then((e=>{if(200===e.status)return r.A.session_info();t("get-scan-groups failed")})).then((r=>{if(200!==r.status)return void t("sessioninfo failed");let o=r.result.scan_id_status,i=!1;if(!0===o.required&&!1===o.succeeded){for(let e=0;e<n.length;e++){if(e+1>o.count)break;let t=n[e];!0!==o.names[t]&&((0,a.A)().set_one_error(t,"DISPLAY ERROR"),i=!0)}i?(s.A.adjust_view(!0),t("scan required, reject validate")):e()}else e()})):e()}))}displayed_scan_inputs_in_current_tab(){let e=[],t=s.A.active_tab();for(let n in t){let r=s.A.first_value(t[n]),a=s.A.first_key(t[n]);"scan_modal"!==r.type_settings?.upload&&"veriface_modal"!==r.type_settings?.upload||e.push(a)}return e}check_flow_scan_promise(){return new Promise(((e,t)=>{let n=this.displayed_scan_inputs_in_current_tab();0!==n.length?Promise.resolve().then((()=>o.A.identity_flow_refresh())).then((e=>{if(200===e.status)return i.A.flow_status();t("osmapi/identity-scan-check failed")})).then((n=>{if(200!==n.status)return void t("status failed");let r=n.result?.data?.workflowStatus?.actions,o=!1;for(let e in r){if("identityScan"!==r[e].function)continue;let t=r[e]?.functionParams?.identToken;"success"!==r[e].state&&((0,a.A)().set_one_error(t,"DISPLAY ERROR"),o=!0)}o?(s.A.adjust_view(!0),t("scan required, reject validate")):e()})):e()}))}}t.A=new _},2310:function(e,t,n){n(4114);var s=n(3175),r=n(8700),a=n(5143);class o{flow_init_session(){let e={action_name:"init",method:"GET",url:(0,r.A)().endpoint_url()+"osmapp/init/"+(0,r.A)().get_flow_id()},t=new s.A;return t.prepare_params(e).handle_response().then((e=>(200!==e.status||((0,r.A)().set_session_token(e.result?.data?.session),(0,a.A)().set_workflow_status(e.result?.data?.workflowStatus),(0,a.A)().set_workflow_name(e.result?.data?.workflow)),e))).catch((e=>{throw e}))}flow_next_step(e){var t=0;let n={action_name:"nextstep",method:"GET",url:(0,r.A)().endpoint_url()+"osmapp/nextstep/"+(0,r.A)().get_session_token()};var o=[];void 0!==e&&o.push("step="+e),t>0&&o.push("&delay="+1e3*t),o.push("with-session-data=1"),(0,r.A)().is_prod_endpoint()||o.push("debug-info=1"),o.length>0&&(n.url+="/?"+o.join("&"));let i=new s.A;return i.prepare_params(n).handle_response().then((e=>(200!==e.status||((0,a.A)().set_workflow_status(e.result?.data?.workflowStatus),(0,a.A)().set_workflow_name(e.result?.data?.workflow)),e))).catch((e=>{throw e}))}flow_status(){let e={action_name:"status",method:"GET",url:(0,r.A)().endpoint_url()+"osmapp/status/"+(0,r.A)().get_session_token()};var t=[];t.push("with-session-data=1"),(0,r.A)().is_prod_endpoint()||t.push("debug-info=1"),t.length>0&&(e.url+="/?"+t.join("&"));let n=new s.A;return n.prepare_params(e).handle_response().then((e=>(200!==e.status||((0,a.A)().set_workflow_status(e.result?.data?.workflowStatus),(0,a.A)().set_workflow_name(e.result?.data?.workflow)),e))).catch((e=>{throw e}))}}t.A=new o},2878:function(e,t,n){var s=n(8700),r=n(6343),a=n(3175),o=n(3177);class i{get_group_form(){let e={action_name:"getgroupform",method:"GET",url:(0,s.A)().endpoint_url()+"online/getgroupform/"+(0,s.A)().product_group_id()+"/?global=2&json=1"};e.url+=r.A.add_token_as_parameter(),e.url+=(0,o.A)().agent_code_param();let t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}validate_group_form(){let e={action_name:"validategroupform",method:"POST",body:r.A.serialize_user_input(),url:(0,s.A)().endpoint_url()+"online/validategroupform/"+(0,s.A)().product_group_id()+"/?global=2&without_form=1"};e.url+=r.A.add_token_as_parameter(),e.url+=(0,o.A)().add_filtered_param();let t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}}t.A=new i},8222:function(e,t,n){var s=n(8700),r=n(6343),a=n(3175),o=n(3177);class i{get_user_form(){let e={action_name:"getform",method:"POST",body:null,url:(0,s.A)().endpoint_url()+"online/getform/"+(0,o.A)().get_selected_product().form_id+"/?json=1"};e.url+=r.A.add_token_as_parameter();let t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}validate_user_form(){let e={action_name:"validateform",method:"POST",body:r.A.serialize_user_input(),url:(0,s.A)().endpoint_url()+"online/validateform/"+(0,o.A)().get_selected_product().form_id+"/?without_form=1"};e.url+=r.A.add_token_as_parameter();let t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}}t.A=new i},6884:function(e,t,n){var s=n(8700),r=n(6343),a=n(3175);class o{identity_scan(e,t,n){let o={action_name:"identity-scan",method:"GET",url:(0,s.A)().endpoint_url()+"online/identity-scan/?"+r.A.add_token_as_parameter()};o.url+="&serviceToken=veriface&scanGroupName="+t+"&identType="+n+"&identNew="+(e?"true":"false");let i=new a.A;return i.prepare_params(o).handle_response().catch((e=>{throw e}))}identity_check(e){let t={action_name:"identity-scan-check",method:"GET",url:(0,s.A)().endpoint_url()+"online/identity-scan-check/?"+r.A.add_token_as_parameter()};t.url+="&serviceToken=veriface&scanGroupName="+e;let n=new a.A;return n.prepare_params(t).handle_response().catch((e=>{throw e}))}identity_refresh(){let e={action_name:"id-scan/get-scan-groups",method:"GET",url:(0,s.A)().endpoint_url()+"api/online/id-scan/get-scan-groups/?"+r.A.add_token_as_parameter()},t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}identity_flow_scan(e,t,n,r){let o={action_name:"identity-scan",method:"GET",url:(0,s.A)().endpoint_url()+"osmapi/identity-scan/"+(0,s.A)().get_session_token()+"/?"};o.url+="serviceToken=veriface&identToken="+t+"&identType="+n+"&action-id="+r+"&identNew="+(e?"true":"false");let i=new a.A;return i.prepare_params(o).handle_response().catch((e=>{throw e}))}identity_flow_check(e,t){let n={action_name:"identity-scan-check",method:"GET",url:(0,s.A)().endpoint_url()+"osmapi/identity-scan-check/"+(0,s.A)().get_session_token()+"/?"};n.url+="serviceToken=veriface&identToken="+e+"&action-id="+t;let r=new a.A;return r.prepare_params(n).handle_response().catch((e=>{throw e}))}identity_flow_refresh(){let e={action_name:"identity-scan-check",method:"GET",url:(0,s.A)().endpoint_url()+"osmapi/identity-scan-check/"+(0,s.A)().get_session_token()+"/?"};e.url+="serviceToken=veriface";let t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}}t.A=new o},9452:function(e,t,n){var s=n(8700),r=n(6343),a=n(3175);class o{session_info(){let e={action_name:"getsessioninfo",method:"GET",url:(0,s.A)().endpoint_url()+"online/getsessioninfo/?"+r.A.add_token_as_parameter()},t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}get_data(){let e={action_name:"getdata",method:"GET",url:(0,s.A)().endpoint_url()+"online/getdata/?"+r.A.add_token_as_parameter()},t=new a.A;return t.prepare_params(e).handle_response().catch((e=>{throw e}))}set_data(e){let t={action_name:"setdata",method:"POST",url:(0,s.A)().endpoint_url()+"online/setdata/?"+r.A.serialize_object(e)+r.A.add_token_as_parameter()},n=new a.A;return n.prepare_params(t).handle_response().catch((e=>{throw e}))}}t.A=new o},3367:function(e,t,n){n.d(t,{A:function(){return A}});var s=n(641),r=n(3751);const a={class:"row mt-4 form-pagination","data-cy":"navigation"},o={class:"col-12 col-sm-4 text-center text-sm-start order-2 order-sm-1"},i={class:"col-12 col-sm-4 text-center order-3 order-sm-2"},_={class:"col-12 col-sm-4 text-center text-sm-end order-1 order-sm-3"},l=["disabled","title"];function c(e,t,n,c,d,u){const p=(0,s.g2)("Bouncer_loading");return(0,s.uX)(),(0,s.CE)("div",a,[(0,s.Lk)("div",o,[n.show_back?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>u.prev&&u.prev(...e)),type:"button",class:"btn btn-light btn-left btn-lg"}," Naspäť ")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",i,[(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>u.clear&&u.clear(...e)),type:"button",class:"btn btn-white btn-lg"}," Vymazať údaje ")]),(0,s.Lk)("div",_,[(0,s.bo)((0,s.bF)(p,null,null,512),[[r.aG,u.loading]]),n.show_next?(0,s.bo)(((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[2]||(t[2]=(...e)=>u.next&&u.next(...e)),disabled:n.disable_next,title:n.disable_next?"Pokúšame sa zopakovať požiadavku.":"",type:"button",class:"btn btn-primary btn-right btn-lg"}," Pokračovať ",8,l)),[[r.aG,!u.loading]]):(0,s.Q3)("",!0)])])}var d=n(55),u=n(2873),p={props:{show_back:Boolean,show_next:Boolean,disable_next:Boolean},components:{Bouncer_loading:d.A},emits:["next","prev"],data(){return{}},created(){},methods:{next(){this.$emit("next")},prev(){this.$emit("prev")},clear(){(0,u.A)().open_it("Cleaning_session")}},computed:{loading(){return(0,u.A)().is_loading()}}},h=n(6262);const m=(0,h.A)(p,[["render",c]]);var A=m},3572:function(e,t,n){n.r(t),n.d(t,{default:function(){return j}});var s=n(641);const r={"data-cy":"calc_forms"};function a(e,t,n,a,o,i){const _=(0,s.g2)("Zeteo_nav"),l=(0,s.g2)("Tabs"),c=(0,s.g2)("Navigation");return(0,s.uX)(),(0,s.CE)("section",r,[i.classic_np_nav?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(_,{key:0,onPrev:i.prev_button,onNext:i.next_button,show_back:i.show_back},null,8,["onPrev","onNext","show_back"])),(0,s.bF)(l),i.classic_np_nav?((0,s.uX)(),(0,s.Wv)(c,{key:1,onPrev:i.prev_button,onNext:i.next_button,show_back:i.show_back,show_next:o.agent_clearance_ok,disable_next:!1},null,8,["onPrev","onNext","show_back","show_next"])):(0,s.Q3)("",!0)])}var o=n(3367),i=n(3751);const _={class:"step_progress_alt_pagination text-end","data-cy":"navigation"};function l(e,t,n,r,a,o){const l=(0,s.g2)("Bouncer_loading");return(0,s.uX)(),(0,s.CE)("div",_,[n.show_back?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>o.prev&&o.prev(...e)),class:"btn btn-outline-primary btn-left btn-m me-1"}," Späť ")):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>o.clear&&o.clear(...e)),class:"btn btn-outline-primary btn-m me-1"}," Zmazať údaje "),(0,s.bo)((0,s.bF)(l,{style:{"margin-right":"19px","margin-left":"20px","padding-top":"5px"}},null,512),[[i.aG,o.loading]]),(0,s.bo)((0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.next&&o.next(...e)),class:"btn btn-primary btn-right btn-m"}," Ďalej ",512),[[i.aG,!o.loading]])])}var c=n(55),d=n(2873),u={props:{show_back:Boolean},components:{Bouncer_loading:c.A},emits:["next","prev"],data(){return{}},created(){},methods:{next(){this.$emit("next")},prev(){this.$emit("prev")},clear(){(0,d.A)().open_it("Cleaning_session")}},computed:{loading(){return(0,d.A)().is_loading()}},watch:{}},p=n(6262);const h=(0,p.A)(u,[["render",l]]);var m=h,A=n(2878),f=n(8222),w=n(6343),v=n(6934),g=n(6460),k=n(8700),b=n(9452),y=n(3177),x=n(8439),T=n(9614),P=n(7618),E={props:{},components:{Navigation:o.A,Tabs:v.A,Zeteo_nav:m},data(){return{is_step:1,is_fresh_session:!1,agent_clearance_ok:!0}},created(){(0,d.A)().open_it("Loading"),this.is_step=(0,k.A)().current_step(),(0,k.A)().is_fresh_session()&&(this.is_fresh_session=!0);var e=(0,k.A)().myport_session_token_promise();Promise.resolve().then((()=>this.is_fresh_session&&null===e?Promise.resolve():this.is_fresh_session&&null!==e?e().then((e=>{console.log("using session from myport: "+typeof e,e),(0,k.A)().set_session_token(e)})):b.A.session_info())).then((e=>!this.is_fresh_session&&e?.result?.state>=100?((0,d.A)().close_them_all(),(0,k.A)().change_step(5),Promise.reject("session already confirmed")):(this.is_fresh_session||1!==e.result.read_only||(0,k.A)().set_read_only(),Promise.resolve()))).then((()=>3===this.is_step&&void 0===(0,y.A)().get_selected_product().form_id?b.A.get_data():Promise.resolve())).then((e=>{void 0!==e&&(0,y.A)().extract_selected_product(e)})).then((()=>1===this.is_step?A.A.get_group_form():3===this.is_step?f.A.get_user_form():void 0)).then((t=>{if(423===t.status&&(this.agent_clearance_ok=!1),200!==t.status)return;(0,d.A)().close_them_all(),this.is_fresh_session&&null===e&&(0,k.A)().set_session_token(t.result.token),(0,y.A)().store_call_params(t.result.call_params);let n=t.result.form;(0,g.A)().set_form(n),(0,y.A)().insert_form_values(n),(0,T.A)().set_tab_keys(n),x.A.height_lock_done(),x.A.store_form_cache(this.is_fresh_session),this.is_fresh_session&&b.A.set_data({osm_author_spa:1})})).catch((e=>{console.log(e)}))},methods:{prev_button(){(0,T.A)().current_tab_is_first()?((0,g.A)().clear_form(),(0,y.A)().reset_form_values(),(0,T.A)().reset_tab_keys(),(0,k.A)().change_step(2)):((0,T.A)().decrease_tab(),w.A.this_tab_is_empty()&&this.prev_button(),w.A.adjust_view())},next_button(){(0,k.A)().is_read_only()?this.check_errors_go_next({result:{validform:!0}}):((0,d.A)().open_it("Loading"),Promise.resolve().then((()=>P.A.check_scan_promise())).then((()=>1===this.is_step?A.A.validate_group_form():3===this.is_step?f.A.validate_user_form():void 0)).then((e=>{(0,d.A)().close_them_all(),200===e.status&&((0,g.A)().clear_errors(),this.check_errors_go_next(e))})).catch((e=>{console.log(e),(0,d.A)().close_them_all()})))},check_errors_go_next(e){if((0,T.A)().current_tab_is_last())!0===e.result.validform?((0,g.A)().clear_form(),(0,y.A)().reset_form_values(),(0,T.A)().reset_tab_keys(),(0,k.A)().change_step(this.is_step+1)):((0,g.A)().set_errors(e.result.form_validation_error_elements),(0,T.A)().open_first_tab_with_error(e.result.form_validation_error_tab_elements),w.A.adjust_view(!0));else{let t=e.result.form_validation_error_tab_elements?.[(0,T.A)().get_current_tab()];void 0===t?((0,T.A)().increase_tab(),w.A.this_tab_is_empty()&&this.check_errors_go_next(e),w.A.adjust_view()):((0,g.A)().set_errors(t),w.A.adjust_view(!0))}}},computed:{show_back(){return(3===this.is_step||!(0,T.A)().current_tab_is_first())&&this.agent_clearance_ok},classic_np_nav(){return!(0,k.A)().is_zeteo_skin()},requested_direction(){return(0,T.A)().get_requested_direction()}},watch:{requested_direction(){null!==this.requested_direction&&("backward"===this.requested_direction?((0,T.A)().reset_requested_direction(),this.prev_button()):"forward"===this.requested_direction&&((0,T.A)().reset_requested_direction(),this.next_button()))}}};const G=(0,p.A)(E,[["render",a]]);var j=G}}]);